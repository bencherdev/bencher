---
title: "Criterion"
description: "å¦‚ä½•ç”¨Criterionå¯¹Rustä»£ç è¿›è¡ŒåŸºå‡†æµ‹è¯•çš„è¯¦ç»†æ­¥éª¤æŒ‡å—"
heading: "å¦‚ä½•æ ‡å‡†Rustä»£ç ä¸Criterion"
published: "2024-01-28T14:20:00Z"
modified: "2024-02-13T06:50:00Z"
sortOrder: 2
---

import Benchmarking from "../../../chunks/benchmarking/zh/benchmarking.mdx";
import FizzBuzzRules from "../../../chunks/benchmarking/zh/fizz-buzz-rules.mdx";
import FizzBuzzRust from "../../../chunks/rust/zh/fizz-buzz-rust.mdx";
import StepByStepRust from "../../../chunks/rust/zh/step-by-step-rust.mdx";
import MicroVsMacro from "../../../chunks/benchmarking/zh/micro-vs-macro.mdx";
import BenchmarkingRust from "../../../chunks/rust/zh/benchmarking-rust.mdx";
import FizzBuzzRefactor from "../../../chunks/rust/criterion/zh/fizz-buzz-refactor.mdx";
import GameBenchesTree from "../../../chunks/rust/criterion/game-benches-tree.mdx";
import FizzBuzzRefactorBenchesCode from "../../../chunks/rust/criterion/fizz-buzz-refactor-benches-code.mdx";
import GameCargoToml from "../../../chunks/rust/criterion/game-cargo-toml.mdx";
import BenchPlayGameOutput from "../../../chunks/rust/criterion/bench-play-game-output.mdx";
import FizzBuzzFibonacciRust from "../../../chunks/rust/zh/fizz-buzz-fibonacci-rust.mdx";
import PlayGameRustCode from "../../../chunks/rust/criterion/play-game-rust-code.mdx";
import BenchPlayGameFibonacciOutput from "../../../chunks/rust/criterion/bench-play-game-fibonacci-output.mdx";
import FizzBuzzFibonacciOpenRust from "../../../chunks/rust/zh/fizz-buzz-fibonacci-open-rust.mdx";
import FizzBuzzFibonacciOpenRustCode from "../../../chunks/rust/criterion/fizz-buzz-fibonacci-open-rust-code.mdx";
import TheEnd from "../../../chunks/benchmarking/zh/the-end.mdx";
import OnFire from "../../../chunks/benchmarking/zh/on-fire.mdx";
import BenchPlayGameOnFireCode from "../../../chunks/rust/criterion/bench-play-game-on-fire-code.mdx";
import BenchPlayGameOnFireOutputStart from "../../../chunks/rust/criterion/bench-play-game-on-fire-output-start.mdx";
import BenchPlayGameOnFireOutput from "../../../chunks/rust/criterion/bench-play-game-on-fire-output.mdx";
import FizzBuzzFibonacciFixRust from "../../../chunks/rust/zh/fizz-buzz-fibonacci-fix-rust.mdx";
import BenchPlayGameFixOutput from "../../../chunks/rust/criterion/bench-play-game-fix-output.mdx";
import CatchInCi from "../../../chunks/benchmarking/zh/catch-in-ci.mdx";
import CatchInCiOutput from "../../../chunks/rust/criterion/catch-in-ci-output.mdx";
import CatchInCiPlot from "../../../chunks/benchmarking/zh/catch-in-ci-plot.mdx";
import CatchInCiPlotRustBench from "../../../chunks/rust/catch-in-ci-plot-rust-bench.mdx";
import BencherFooter from "../../../chunks/learn/zh/bencher-footer.mdx";

<Benchmarking />

<FizzBuzzRust />

<StepByStepRust />

<MicroVsMacro />

<BenchmarkingRust />

ä¸‰è€…éƒ½æ˜¯[ç”±Bencheræ”¯æŒçš„](/zh/docs/explanation/adapters/)ã€‚é‚£ä¹ˆä¸ºä»€ä¹ˆè¦é€‰æ‹©Criterionå‘¢ï¼Ÿ
Criterionæ˜¯Rustç¤¾åŒºçš„äº‹å®æ ‡å‡†åŸºå‡†æµ‹è¯•å·¥å…·ã€‚
æˆ‘æ¨èä½¿ç”¨Criterionæ¥æµ‹è¯•ä½ çš„ä»£ç çš„å»¶è¿Ÿã€‚
ä¹Ÿå°±æ˜¯è¯´ï¼ŒCriterionéå¸¸é€‚åˆæµ‹é‡æ—¶é’Ÿæ—¶é—´ã€‚

<FizzBuzzRefactor />

## å¯¹FizzBuzzçš„åŸºå‡†æµ‹è¯•

ä¸ºäº†å¯¹æˆ‘ä»¬çš„ä»£ç è¿›è¡ŒåŸºå‡†æµ‹è¯•ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ª`benches`ç›®å½•ï¼Œå¹¶æ·»åŠ ä¸€ä¸ªæ–‡ä»¶æ¥åŒ…å«æˆ‘ä»¬çš„åŸºå‡†æµ‹è¯•ï¼Œ`play_game.rs`ï¼š

<GameBenchesTree />

åœ¨`play_game.rs`ä¸­å¢åŠ ä¸‹åˆ—ä»£ç ï¼š

<FizzBuzzRefactorBenchesCode />

- å¯¼å…¥`Criterion`åŸºå‡†æµ‹è¯•è¿è¡Œå™¨ã€‚
- ä»æˆ‘ä»¬çš„`game`åŒ…ä¸­å¯¼å…¥`play_game`å‡½æ•°ã€‚
- åˆ›å»ºä¸€ä¸ªåä¸º`bench_play_game`çš„å‡½æ•°ï¼Œå®ƒæ¥å—ä¸€ä¸ªå¯¹`Criterion`çš„å¯å˜å¼•ç”¨ã€‚
- ä½¿ç”¨`Criterion`å®ä¾‹ï¼ˆ`c`ï¼‰æ¥åˆ›å»ºä¸€ä¸ªåä¸º`bench_play_game`çš„åŸºå‡†æµ‹è¯•ã€‚
- ç„¶åä½¿ç”¨åŸºå‡†æµ‹è¯•è¿è¡Œå™¨ï¼ˆ`b`ï¼‰æ¥å¤šæ¬¡è¿è¡Œæˆ‘ä»¬çš„å®åŸºå‡†æµ‹è¯•ã€‚
- åœ¨ä¸€ä¸ª"é»‘ç®±"ä¸­è¿è¡Œæˆ‘ä»¬çš„å®åŸºå‡†æµ‹è¯•ï¼Œè¿™æ ·ç¼–è¯‘å™¨å°±ä¸ä¼šä¼˜åŒ–æˆ‘ä»¬çš„ä»£ç ã€‚
- ä»`1`åˆ°`100`åŒ…æ‹¬ï¼Œè¿›è¡Œè¿­ä»£ã€‚
- å¯¹äºæ¯ä¸€ä¸ªæ•°å­—ï¼Œè°ƒç”¨`play_game`ï¼Œè®¾ç½®`print`ä¸º`false`ã€‚

ç°åœ¨æˆ‘ä»¬éœ€è¦é…ç½®`game`åŒ…æ¥è¿è¡Œæˆ‘ä»¬çš„åŸºå‡†æµ‹è¯•ã€‚

åœ¨ä½ çš„`Cargo.toml`æ–‡ä»¶çš„åº•éƒ¨æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š

<GameCargoToml />

- `criterion`ï¼šå°†`criterion`æ·»åŠ ä¸ºå¼€å‘ä¾èµ–ï¼Œå› ä¸ºæˆ‘ä»¬åªåœ¨æ€§èƒ½æµ‹è¯•ä¸­ä½¿ç”¨å®ƒã€‚
- `bench`ï¼šæ³¨å†Œ`play_game`ä½œä¸ºä¸€ä¸ªåŸºå‡†æµ‹è¯•ï¼Œå¹¶è®¾ç½®`harness`ä¸º`false`ï¼Œå› ä¸ºæˆ‘ä»¬å°†ä½¿ç”¨Criterionä½œä¸ºæˆ‘ä»¬çš„åŸºå‡†æµ‹è¯•å·¥å…·ã€‚

ç°åœ¨æˆ‘ä»¬å·²ç»å‡†å¤‡å¥½è¿›è¡ŒåŸºå‡†æµ‹è¯•äº†ï¼Œè¿è¡Œ`cargo bench`ï¼š

<BenchPlayGameOutput />

> ğŸ° è®©æˆ‘ä»¬è°ƒé«˜èŠ‚æ‹ï¼æˆ‘ä»¬å·²ç»å¾—åˆ°äº†ç¬¬ä¸€ä¸ªåŸºå‡†æµ‹è¯•æŒ‡æ ‡ï¼

æœ€åï¼Œæˆ‘ä»¬å¯ä»¥è®©æˆ‘ä»¬ç–²å€¦çš„å¼€å‘è€…å¤´è„‘å¾—åˆ°ä¼‘æ¯...
å¼€ç©ç¬‘ï¼Œæˆ‘ä»¬çš„ç”¨æˆ·æƒ³è¦ä¸€ä¸ªæ–°åŠŸèƒ½ï¼

<FizzBuzzFibonacciRust>
  <PlayGameRustCode />
</FizzBuzzFibonacciRust>

## å¯¹FizzBuzzFibonacciçš„åŸºå‡†æµ‹è¯•

ç°åœ¨æˆ‘ä»¬å¯ä»¥é‡æ–°è¿è¡Œæˆ‘ä»¬çš„åŸºå‡†æµ‹è¯•äº†ï¼š

<BenchPlayGameFibonacciOutput />

å“¦å“¦ï¼Criterionå‘æˆ‘ä»¬æ˜¾ç¤ºäº†FizzBuzzå’ŒFizzBuzzFibonacciæ¸¸æˆä¹‹é—´æ€§èƒ½å·®è·ä¸º`+568.69%`ã€‚
ä½ çš„æ•°å­—ä¼šæ¯”æˆ‘çš„ç¨å¾®æœ‰äº›ä¸åŒã€‚
ç„¶è€Œï¼Œä¸¤è€…ä¹‹é—´çš„å·®è·å¯èƒ½åœ¨`5x`çš„èŒƒå›´å†…ã€‚
è¿™å¯¹æˆ‘æ¥è¯´çœ‹èµ·æ¥æ˜¯æ¯”è¾ƒå¥½çš„ç»“æœï¼ç‰¹åˆ«æ˜¯è€ƒè™‘åˆ°æˆ‘ä»¬å°†åƒ_Fibonacci_è¿™æ ·çš„èŠ±å“¨åŠŸèƒ½æ·»åŠ åˆ°æˆ‘ä»¬çš„æ¸¸æˆä¸­ã€‚
å­©å­ä»¬ä¼šå–œæ¬¢çš„ï¼

<FizzBuzzFibonacciOpenRust>
  <FizzBuzzFibonacciOpenRustCode />
</FizzBuzzFibonacciOpenRust>

<TheEnd />

<br />

<OnFire />

<BenchPlayGameOnFireCode />

- ä¸€ä¸ªç”¨äºç©æ¸¸æˆå¹¶è¾“å…¥æ•°å­—ä¸€ç™¾ï¼ˆ`100`ï¼‰çš„å¾®åŸºå‡†æµ‹è¯•`bench_play_game_100`ã€‚
- ä¸€ä¸ªç”¨äºç©æ¸¸æˆå¹¶è¾“å…¥æ•°å­—ä¸€ç™¾ä¸‡ï¼ˆ`1_000_000`ï¼‰çš„å¾®åŸºå‡†æµ‹è¯•`bench_play_game_1_000_000`ã€‚

å½“æˆ‘è¿è¡Œå®ƒæ—¶ï¼Œæˆ‘å¾—åˆ°äº†è¿™ä¸ªï¼š

<BenchPlayGameOnFireOutputStart />

ç­‰å¾…ä¸€ä¸‹... ç­‰å¾…ä¸€ä¸‹...

<BenchPlayGameOnFireOutput />

ä»€ä¹ˆï¼`403.57 ns` x `1,000` åº”è¯¥æ˜¯ `403,570 ns` è€Œä¸æ˜¯ `9,596,800 ns` (`9.5968 ms` x `1_000_000 ns/1 ms`) ğŸ¤¯
å°½ç®¡æˆ‘çš„æ–æ³¢é‚£å¥‘æ•°åˆ—ä»£ç åŠŸèƒ½ä¸Šæ˜¯æ­£ç¡®çš„ï¼Œæˆ‘å¿…é¡»åœ¨æŸä¸ªåœ°æ–¹æœ‰ä¸€ä¸ªæ€§èƒ½bugã€‚

<FizzBuzzFibonacciFixRust />

ç°åœ¨ï¼Œè®©æˆ‘ä»¬é‡æ–°è¿è¡Œè¿™äº›åŸºå‡†æµ‹è¯•ï¼Œçœ‹çœ‹æˆ‘ä»¬åšå¾—å¦‚ä½•ï¼š

<BenchPlayGameFixOutput />

å“¦å“‡ï¼æˆ‘ä»¬çš„`bench_play_game`åŸºå‡†æµ‹è¯•å›è½åˆ°åŸæ¥FizzBuzzæµ‹è¯•çš„é™„è¿‘ä½ç½®ã€‚
æˆ‘å¸Œæœ›æˆ‘èƒ½è®°ä½é‚£ä¸ªå¾—åˆ†æ˜¯å¤šå°‘ã€‚ä½†æ˜¯å·²ç»è¿‡äº†ä¸‰ä¸ªæ˜ŸæœŸäº†ã€‚
æˆ‘çš„ç»ˆç«¯å†å²è®°å½•æ²¡æœ‰å›æº¯è¿™ä¹ˆè¿œã€‚
è€ŒCriterionåªä¼šå’Œæœ€è¿‘çš„ç»“æœè¿›è¡Œæ¯”è¾ƒã€‚
ä½†æˆ‘è®¤ä¸ºè¿™æ˜¯å¾ˆæ¥è¿‘çš„ï¼

`bench_play_game_100`åŸºå‡†æµ‹è¯•çš„ç»“æœä¸‹é™äº†è¿‘10å€ï¼Œ`-93.950%`ã€‚
å’Œ`bench_play_game_1_000_000`åŸºå‡†æµ‹è¯•çš„ç»“æœä¸‹é™äº†è¶…è¿‡10,000å€ï¼ä»`9,596,800 ns`é™åˆ°`30.403 ns`ï¼
æˆ‘ä»¬ç”šè‡³è®©Criterionçš„æ”¹å˜è®¡æ•°å™¨è¾¾åˆ°äº†æœ€å¤§å€¼ï¼Œå®ƒåªä¼šè¾¾åˆ°`-100.000%`ï¼

> ğŸ° å˜¿ï¼Œè‡³å°‘æˆ‘ä»¬åœ¨æ€§èƒ½bugèµ¶åˆ°ç”Ÿäº§ç¯å¢ƒä¹‹å‰æŠ“ä½äº†å®ƒ... å“¦ï¼Œå¯¹äº†ã€‚ç®—äº†...

<CatchInCi />

<CatchInCiOutput />

<CatchInCiPlot />

<CatchInCiPlotRustBench title="å¦‚ä½•ç”¨Criterionå¯¹Rustè¿›è¡ŒåŸºå‡†æµ‹è¯•" />

<BencherFooter />