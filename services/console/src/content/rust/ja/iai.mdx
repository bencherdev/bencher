---
title: "Iai"
description: "Rustã‚³ãƒ¼ãƒ‰ã‚’Iaiã§ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã™ã‚‹ãŸã‚ã®ã‚¹ãƒ†ãƒƒãƒ—ãƒã‚¤ã‚¹ãƒ†ãƒƒãƒ—ã‚¬ã‚¤ãƒ‰"
heading: "Iaiã‚’ä½¿ç”¨ã—ã¦Rustã‚³ãƒ¼ãƒ‰ã‚’ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã™ã‚‹æ–¹æ³•"
sortOrder: 3
---

import Benchmarking from "../../../chunks/benchmarking/ja/benchmarking.mdx";
import FizzBuzzRules from "../../../chunks/benchmarking/ja/fizz-buzz-rules.mdx";
import FizzBuzzRust from "../../../chunks/rust/ja/fizz-buzz-rust.mdx";
import StepByStepRust from "../../../chunks/rust/ja/step-by-step-rust.mdx";
import MicroVsMacro from "../../../chunks/benchmarking/ja/micro-vs-macro.mdx";
import BenchmarkingRust from "../../../chunks/rust/ja/benchmarking-rust.mdx";
import FizzBuzzRefactor from "../../../chunks/rust/criterion/ja/fizz-buzz-refactor.mdx";
import GameBenchesTree from "../../../chunks/rust/criterion/game-benches-tree.mdx";
import FizzBuzzRefactorBenchesCode from "../../../chunks/rust/iai/fizz-buzz-refactor-benches-code.mdx";
import GameCargoToml from "../../../chunks/rust/iai/game-cargo-toml.mdx";
import BenchPlayGameOutput from "../../../chunks/rust/iai/bench-play-game-output.mdx";
import FizzBuzzFibonacciRust from "../../../chunks/rust/ja/fizz-buzz-fibonacci-rust.mdx";
import PlayGameRustCode from "../../../chunks/rust/criterion/play-game-rust-code.mdx";
import BenchPlayGameFibonacciOutput from "../../../chunks/rust/iai/bench-play-game-fibonacci-output.mdx";
import FizzBuzzFibonacciOpenRust from "../../../chunks/rust/ja/fizz-buzz-fibonacci-open-rust.mdx";
import FizzBuzzFibonacciOpenRustCode from "../../../chunks/rust/criterion/fizz-buzz-fibonacci-open-rust-code.mdx";
import TheEnd from "../../../chunks/benchmarking/ja/the-end.mdx";
import OnFire from "../../../chunks/benchmarking/ja/on-fire.mdx";
import BenchPlayGameOnFireCode from "../../../chunks/rust/iai/bench-play-game-on-fire-code.mdx";
import BenchPlayGameOnFireOutputStart from "../../../chunks/rust/iai/bench-play-game-on-fire-output-start.mdx";
import BenchPlayGameOnFireOutput from "../../../chunks/rust/iai/bench-play-game-on-fire-output.mdx";
import FizzBuzzFibonacciFixRust from "../../../chunks/rust/ja/fizz-buzz-fibonacci-fix-rust.mdx";
import BenchPlayGameFixOutput from "../../../chunks/rust/iai/bench-play-game-fix-output.mdx";
import CatchInCi from "../../../chunks/benchmarking/ja/catch-in-ci.mdx";
import CatchInCiOutput from "../../../chunks/rust/iai/catch-in-ci-output.mdx";
import CatchInCiPlot from "../../../chunks/benchmarking/ja/catch-in-ci-plot.mdx";
import CatchInCiPlotRustBench from "../../../chunks/rust/catch-in-ci-plot-rust-bench.mdx";
import BencherFooter from "../../../chunks/learn/ja/bencher-footer.mdx";

<Benchmarking />

<FizzBuzzRust />

<StepByStepRust />

<MicroVsMacro />

<BenchmarkingRust />

ã™ã¹ã¦ãŒ[ãƒ™ãƒ³ãƒãƒ£ãƒ¼ã«ã‚ˆã£ã¦ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã™](/ja/docs/explanation/adapters/)ã€‚ãªãœIaiã‚’é¸ã¶ã®ã§ã—ã‚‡ã†ã‹ï¼Ÿ
Iaiã¯å£æ›ã‘æ™‚é–“ã§ã¯ãªãã€å‘½ä»¤æ•°ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚
ã“ã‚Œã¯ã€CIã§ã®ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã€ã¤ã¾ã‚Š[é€£ç¶šçš„ãªãƒ™ãƒ³ãƒãƒãƒ¼ã‚­ãƒ³ã‚°](/ja/docs/explanation/continuous-benchmarking/)ã«ç†æƒ³çš„ã§ã™ã€‚
ç‰¹ã«å…±æœ‰ãƒ©ãƒ³ãƒŠãƒ¼ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆã€CIã§ã®é€£ç¶šçš„ãªãƒ™ãƒ³ãƒãƒãƒ¼ã‚­ãƒ³ã‚°ã«ã¯Iaiã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚
IaiãŒæœ¬å½“ã«æ°—ã«ãªã‚‹ã“ã¨ã®ä»£ç†ã¨ã—ã‹æ¸¬å®šã—ãªã„ã“ã¨ã‚’ç†è§£ã™ã‚‹ã“ã¨ãŒé‡è¦ã§ã™ã€‚
1,000å‘½ä»¤ã‹ã‚‰2,000å‘½ä»¤ã«å¢—åŠ ã™ã‚‹ã“ã¨ã§ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ãŒ2å€ã«ãªã‚‹ã®ã§ã—ã‚‡ã†ã‹ï¼Ÿ
ãã‚Œã¯ã‚‚ã—ã‹ã—ãŸã‚‰ãã†ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã—ã€ãã†ã§ãªã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚
ã“ã®ãŸã‚ã€å‘½ä»¤æ•°ãƒ™ãƒ¼ã‚¹ã®ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã¨ä¸¦è¡Œã—ã¦å£æ›ã‘æ™‚é–“ãƒ™ãƒ¼ã‚¹ã®ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã‚‚æœ‰ç”¨ã§ã™ã€‚

> ğŸ° Iaiã¯[3å¹´ä»¥ä¸Šæ›´æ–°ã•ã‚Œã¦ã„ã¾ã›ã‚“](https://github.com/bheisler/iai/commits/main/)ã€‚ãã®ãŸã‚ã€ä»£ã‚ã‚Šã«[Iai-Callgrindã®ä½¿ç”¨](/ja/docs/explanation/adapters/#-rust-iai-callgrind)ã‚’æ¤œè¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

## Valgrindã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

Iaiã¯å‘½ä»¤æ•°ã‚’åé›†ã™ã‚‹ãŸã‚ã«[Valgrind](https://valgrind.org/)ã¨ã„ã†ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚
Valgrindã¯Linuxã€Solarisã€FreeBSDã€macOSã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ã€‚
ãŸã ã—ã€macOSã®ã‚µãƒãƒ¼ãƒˆã¯x86_64ãƒ—ãƒ­ã‚»ãƒƒã‚µã«é™å®šã•ã‚Œã¦ãŠã‚Šã€[ã¾ã arm64ï¼ˆM1ã€M2ãªã©ï¼‰ãƒ—ãƒ­ã‚»ãƒƒã‚µã¯ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“](https://github.com/LouisBrunner/valgrind-macos/issues/56)ã€‚

Debianã§ã®å®Ÿè¡Œï¼š`sudo apt-get install valgrind`

MacOSï¼ˆx86_64/Intelãƒãƒƒãƒ—ã®ã¿ï¼‰ï¼š`brew install valgrind`

<FizzBuzzRefactor />

## FizzBuzzã‚’ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã™ã‚‹

ã‚³ãƒ¼ãƒ‰ã‚’ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã™ã‚‹ãŸã‚ã«ã€`benches`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã—ã€ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã‚’å«ã‚€ãƒ•ã‚¡ã‚¤ãƒ«`play_game.rs`ã‚’è¿½åŠ ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼š

<GameBenchesTree />

`play_game.rs`ã®ä¸­ã«ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ ã—ã¾ã™ï¼š

<FizzBuzzRefactorBenchesCode />

- `game`ã‚¯ãƒ¬ãƒ¼ãƒˆã‹ã‚‰`play_game`é–¢æ•°ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã™ã€‚
- `bench_play_game`ã¨ã„ã†åå‰ã®é–¢æ•°ã‚’ä½œæˆã—ã¾ã™ã€‚
- ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãŒã‚³ãƒ¼ãƒ‰ã‚’æœ€é©åŒ–ã™ã‚‹ã®ã‚’é˜²ããŸã‚ã«ã€ãƒã‚¯ãƒ­ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã‚’"black box"ã®ä¸­ã§å®Ÿè¡Œã—ã¾ã™ã€‚
- `1`ã‹ã‚‰`100`ã¾ã§ï¼ˆå«ã‚€ï¼‰ã‚’åå¾©ã—ã¾ã™ã€‚
- å„æ•°å­—ã«å¯¾ã—ã¦ã€`play_game`ã‚’å‘¼ã³å‡ºã—ã€`print`ã‚’`å½`ã«è¨­å®šã—ã¾ã™ã€‚

æ¬¡ã«ã€ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã«`game`ã‚¯ãƒ¬ãƒ¼ãƒˆã‚’è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

`Cargo.toml`ãƒ•ã‚¡ã‚¤ãƒ«ã®_ä¸‹éƒ¨_ã«ä»¥ä¸‹ã‚’è¿½åŠ ã—ã¾ã™ï¼š

<GameCargoToml />

- `iai`: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆã«ã®ã¿ä½¿ç”¨ã™ã‚‹ãŸã‚ã€`iai`ã‚’é–‹ç™ºä¾å­˜é–¢ä¿‚ã¨ã—ã¦è¿½åŠ ã—ã¾ã™ã€‚
- `bench`: `play_game`ã‚’ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã¨ã—ã¦ç™»éŒ²ã—ã€ãƒãƒ¼ãƒã‚¹ã‚’`false`ã«è¨­å®šã—ã¾ã™ã€‚ãªãœãªã‚‰ã€ç§ãŸã¡ã¯Iaiã‚’ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ãƒãƒ¼ãƒã‚¹ã¨ã—ã¦ä½¿ç”¨ã™ã‚‹äºˆå®šã ã‹ã‚‰ã§ã™ã€‚

ã“ã‚Œã§ã‚³ãƒ¼ãƒ‰ã®ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ãŒå¯èƒ½ã«ãªã‚Šã¾ã—ãŸã€‚ `cargo bench`ã‚’å®Ÿè¡Œã—ã¾ã™ï¼š

<BenchPlayGameOutput />

>ğŸ° ãƒ¬ã‚¿ã‚¹ã®ãƒ“ãƒ¼ãƒˆã‚’ã‚¿ãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ï¼ æˆ‘ã€…ã¯æˆ‘ã€…ã®æœ€åˆã®ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯æ¸¬å®šå€¤ã‚’å¾—ã¾ã—ãŸï¼

ã¤ã„ã«ã€æˆ‘ã€…ã¯ç–²ã‚Œæœã¦ãŸé–‹ç™ºè€…ã®é ­ã‚’ä¼‘ã‚ã‚‹ã“ã¨ãŒã§ãã¾ã™...
å†—è«‡ã§ã™ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯æ–°æ©Ÿèƒ½ã‚’æœ›ã‚“ã§ã„ã¾ã™ï¼

<FizzBuzzFibonacciRust>
  <PlayGameRustCode />
</FizzBuzzFibonacciRust>

## FizzBuzzFibonacciã®ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯

ã“ã‚Œã§ã€ç§ãŸã¡ã®ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã‚’å†åº¦å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼š

<BenchPlayGameFibonacciOutput />

ãŠãŠã€ãã‚Œã¯ç´ æ™´ã‚‰ã—ã„ï¼Iaiã¯ã€ç§ãŸã¡ã®FizzBuzzã¨FizzBuzzFibonacciã‚²ãƒ¼ãƒ ã®æ¨å®šã‚µã‚¤ã‚¯ãƒ«ã®å·®ãŒ `+522.6091%`ã§ã‚ã‚‹ã¨è¨€ã£ã¦ã„ã¾ã™ã€‚
ã‚ãªãŸã®æ•°å­—ã¯ç§ã®ã‚‚ã®ã¨å°‘ã—ç•°ãªã‚‹ã§ã—ã‚‡ã†ã€‚
ãŸã ã—ã€2ã¤ã®ã‚²ãƒ¼ãƒ é–“ã®é•ã„ã¯ã€ãŠãã‚‰ã`5x`ã®ç¯„å›²ã«ã‚ã‚Šã¾ã™ã€‚
ç§ã¯ãã‚ŒãŒè‰¯ã„ã¨æ€ã†ï¼ ç‰¹ã«ã‚²ãƒ¼ãƒ ã«_Fibonacci_ã¨ã„ã†æ´¾æ‰‹ãªæ©Ÿèƒ½ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã«ã‚ˆã‚Šã€‚å­ä¾›ãŸã¡ã¯ãã‚Œã‚’æ„›ã™ã‚‹ã§ã—ã‚‡ã†ï¼

<FizzBuzzFibonacciOpenRust>
  <FizzBuzzFibonacciOpenRustCode />
</FizzBuzzFibonacciOpenRust>

<TheEnd />

<br />

<OnFire />

<BenchPlayGameOnFireCode />

- æ•°å­—ç™¾ã§ã‚²ãƒ¼ãƒ ã‚’ã™ã‚‹ãƒŸã‚¯ãƒ­ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ `bench_play_game_100`
- æ•°å­—100ä¸‡ã§ã‚²ãƒ¼ãƒ ã‚’ã™ã‚‹ãƒŸã‚¯ãƒ­ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ `bench_play_game_1_000_000`

ç§ãŒãã‚Œã‚’å®Ÿè¡Œã—ãŸã¨ãã€ç§ã¯ã“ã‚Œã‚’å¾—ã¾ã—ãŸï¼š

<BenchPlayGameOnFireOutputStart />

ãã‚Œã‚’å¾…ã£ã¦...ãã‚Œã‚’å¾…ã£ã¦...

<BenchPlayGameOnFireOutput />

ä½•ï¼ `6,685æ¨å®šã‚µã‚¤ã‚¯ãƒ«` x `1,000`ã¯ `6,685,000æ¨å®šã‚µã‚¤ã‚¯ãƒ«`ã§ã‚ã‚‹ã¹ãã§ã‚ã‚Šã€ `155,109,206æ¨å®šã‚µã‚¤ã‚¯ãƒ«`ã§ã¯ãªã„ğŸ¤¯
ãƒ•ã‚£ãƒœãƒŠãƒƒãƒã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã®ã‚³ãƒ¼ãƒ‰ãŒæ©Ÿèƒ½çš„ã«ã¯æ­£ã—ã„ã«ã‚‚ã‹ã‹ã‚ã‚‰ãšã€ä½•ã‹ã—ã‚‰ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®ãƒã‚°ãŒã‚ã‚‹ã¯ãšã§ã™ã€‚

<FizzBuzzFibonacciFixRust />

ãã‚Œã§ã¯ã€ã“ã‚Œã‚‰ã®ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã‚’å†å®Ÿè¡Œã—ã¦ã€ã©ã®ã‚ˆã†ã«ãªã£ãŸã‹è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

<BenchPlayGameFixOutput />

ãŠãŠã€ã‚ã‚ï¼ ç§ãŸã¡ã®`bench_play_game`ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ãŒã‚ªãƒªã‚¸ãƒŠãƒ«ã®FizzBuzzã®ã¨ã“ã‚ã«æˆ»ã£ã¦ãã¾ã—ãŸã€‚
ãã®ã‚¹ã‚³ã‚¢ãŒæ­£ç¢ºã«ä½•ã ã£ãŸã‹æ€ã„å‡ºã›ãŸã‚‰è‰¯ã‹ã£ãŸã®ã§ã™ãŒã€‚ãã‚Œã¯3é€±é–“å‰ã®äº‹ã§ã™ã€‚
ç§ã®ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã®å±¥æ­´ã¯ãã‚Œã»ã©é¡ã‚‰ãªã„ã€‚
ãã—ã¦Iaiã¯æœ€æ–°ã®çµæœã¨ã®ã¿æ¯”è¼ƒã—ã¾ã™ã€‚
ã—ã‹ã—ã€ãã‚Œã¯è¿‘ã„ã¨æ€ã„ã¾ã™ï¼

`bench_play_game_100`ã®ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã¯ã»ã¼10å€ã€ `-87.22513%`æ¸›ã‚Šã¾ã—ãŸã€‚
ãã—ã¦`bench_play_game_1_000_000`ã®ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã¯10,000å€ä»¥ä¸Šæ¸›ã‚Šã¾ã—ãŸï¼ `155,109,206æ¨å®šã‚µã‚¤ã‚¯ãƒ«`ã‹ã‚‰`950æ¨å®š`æ¨å®šã‚µã‚¤ã‚¯ãƒ«ã«ï¼
ãã‚Œã¯ `-99.99939%` ã§ã™ï¼

> ğŸ° ã¾ã‚ã€å°‘ãªãã¨ã‚‚ã“ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒã‚°ã‚’è£½å“ç‰ˆã«å‡ºã™å‰ã«è¦‹ã¤ã‘ã‚‰ã‚ŒãŸã€ã­... ã‚ã€ãã†ã ã€‚å¿˜ã‚Œã¦ãŸ...

<CatchInCi />

<CatchInCiOutput />

<CatchInCiPlot />

<CatchInCiPlotRustBench title="Iaiã‚’ä½¿ç”¨ã—ã¦Rustãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã®æ–¹æ³•" />

<BencherFooter />
