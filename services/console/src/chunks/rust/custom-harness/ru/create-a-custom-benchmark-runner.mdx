import CargoTomlSerdeJson from "../cargo-toml-serde-json.mdx";
import PlayGameRsRun from "../play-game-rs-run.mdx";
import PlayGameMain from "../play-game-rs-main.mdx";

### Создание настраиваемого запускающего субъекта для тестов производительности

Наконец, нам нужно создать запускающий субъект для нашего пользовательского тестового комплекта.
Пользовательский тестовый комплект на самом деле — это просто исполняемый файл,
который запускает все наши тесты и сообщает их результаты.
Запускающий субъект отвечает за управление этим процессом.

Мы хотим, чтобы наши результаты выводились в [формате Bencher Metric Format (BMF) JSON][bmf json].
Для этого нам нужно добавить одну последнюю зависимость,
[пакет `serde_json`][crates serde json] от... вы угадали, Дэвида Толная!

<CargoTomlSerdeJson />

Далее мы реализуем метод для `CustomBenchmark`, чтобы запустить его функцию тестирования
и затем вернуть результаты в виде BMF JSON.

<PlayGameRsRun />

Результаты BMF JSON содержат шесть [измерений][measures] для каждого теста производительности:

- Итоговые блоки: итоговое количество выделенных блоков при завершении теста.
- Итоговые байты: итоговое количество выделенных байтов при завершении теста.
- Максимальные блоки: максимальное количество блоков, выделенных в любое время во время теста.
- Максимальные байты: максимальное количество байтов, выделенных в любое время во время теста.
- Всего блоков: общее количество блоков, выделенных во время теста.
- Всего байтов: общее количество байтов, выделенных во время теста.

Наконец, мы можем создать функцию `main` для выполнения всех тестов в нашей коллекции `inventory`
и вывести результаты в виде BMF JSON.

<PlayGameMain />

[bmf json]: /ru/docs/reference/bencher-metric-format/
[measures]: /ru/docs/explanation/benchmarking/#measures

[crates serde json]: https://crates.io/crates/serde_json