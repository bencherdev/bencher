---
title: "GitHub Actions"
description: "Utiliza Bencher en GitHub Actions para benchmarking continuo en pull requests"
heading: "C√≥mo usar Bencher en GitHub Actions"
sortOrder: 3
---

import GitHubActions1 from "../../../chunks/how_to/github-actions.1.mdx";
import GitHubActions2 from "../../../chunks/how_to/github-actions.2.mdx";
import GitHubActions3 from "../../../chunks/how_to/github-actions.3.mdx";
import GitHubActions4 from "../../../chunks/how_to/github-actions.4.mdx";
import GitHubActions5 from "../../../chunks/how_to/github-actions.5.mdx";
import GitHubActions6 from "../../../chunks/how_to/github-actions.6.mdx";

<GitHubActions1 />

1. Crea una `workflow` de GitHub Actions (por ejemplo, `.github/workflows/benchmark.yml`).
2. Especifica los eventos en los que deber√≠a ejecutarse la `workflow` en `on`. Consulta la [documentaci√≥n de `on` de GitHub Actions](https://docs.github.com/es/actions/using-workflows/workflow-syntax-for-github-actions#on) para obtener una visi√≥n completa. Este workflow se ejecuta **s√≥lo** en eventos `push` en la rama `main`. Para ejecutarlo [en Pull Requests consulta la secci√≥n de abajo](#pull-requests).
3. Crea un `job` de GitHub Actions (por ejemplo, `benchmark_with_bencher`)
4. El Proyecto ya debe existir. Establece la opci√≥n `--project` o la variable de entorno `BENCHER_PROJECT` al slug o UUID del Proyecto. (por ejemplo, `BENCHER_PROJECT: save-walter-white`)
5. A√±ade `BENCHER_API_TOKEN` como un secreto del **Repositorio** (por ejemplo, `Repo -> Configuraci√≥n -> Secretos y variables -> Actions -> Nuevo secreto del repositorio`)
6. El token API ya debe existir. Configura la opci√≥n `--token` o la variable de ambiente `BENCHER_API_TOKEN` al token API. (por ejemplo, `BENCHER_API_TOKEN: ${{ secrets.BENCHER_API_TOKEN }}`)
7. Opcional: Configura la opci√≥n `--adapter` o la variable de ambiente `BENCHER_ADAPTER` al nombre del adaptador deseado. Si no se establece, entonces se usar√° el adaptador `m√°gico`. Consulta [adaptadores de harness de benchmarking](/docs/es/explanation/adapters) para obtener m√°s detalles. (por ejemplo, `BENCHER_ADAPTER: json`)
8. Opcional: Configura la opci√≥n `--testbed` o la variable de ambiente `BENCHER_TESTBED` al slug o UUID del ambiente de pruebas. El ambiente de pruebas debe existir. Si no se configura, se usar√° el ambiente de pruebas `localhost`. (por ejemplo, `BENCHER_TESTBED: ubuntu-latest`)
9. Haz checkout a tu c√≥digo fuente. (por ejemplo, `usa: actions/checkout@v3`)
10. Instala la CLI de Bencher usando [GitHub Action](https://github.com/marketplace/actions/bencher-cli). (por ejemplo, `usa: bencherdev/bencher@main`)
11. [Sigue tus benchmarks](/docs/es/how-to/track-benchmarks) con el comando `<code><a href="/docs/es/explanation/bencher-run">bencher run</a></code>` de la CLI:
    1. Hay varias opciones para establecer la rama del proyecto. Consulta [la selecci√≥n de rama](/docs/es/how-to/branch-selection) para obtener una visi√≥n completa. El comando proporcionado utiliza [variables de entorno predeterminadas de GitHub Action](https://docs.github.com/es/actions/learn-github-actions/variables#default-environment-variables) y trata de:
       1. Usar los datos de la rama actual si ya existe. (por ejemplo, `--if-branch "$GITHUB_REF_NAME"`)
       2. Crear un clon de los datos de la rama objetivo de PR y los umbrales si ya existen. (por ejemplo, `--else-if-branch "$GITHUB_BASE_REF"`)
       3. Si no, crea un clon de los datos de la rama `main` y los umbrales. (por ejemplo, `--else-if-branch main`)
     2. Configura el comando para fallar si se genera una Alerta. Para que se genere una Alerta, un [Umbral](/docs/es/explanation/thresholds) ya debe existir. (por ejemplo, `--err`)
     3. Configura el token de autenticaci√≥n de la API de GitHub (por ejemplo, `--github-actions ${{ secrets.GITHUB_TOKEN }}`). Cuando esta opci√≥n se configura como parte de una pull request, los resultados se a√±aden a la pull request como un comentario. El comando proporcionado utiliza [la variable de entorno `GITHUB_TOKEN` de GitHub Actions](https://docs.github.com/es/actions/security-guides/automatic-token-authentication).
     4. Ejecuta tus benchmarks y genera un informe a partir de los resultados. (por ejemplo, `"bencher mock"`)

<br/>

## Pull Requests

Para detectar la regresi√≥n en el rendimiento en Pull Requests, necesitar√°s ejecutar tus benchmarks en PRs.
Si s√≥lo esperas tener PRs de ramas dentro del mismo repositorio, simplemente puedes modificar el ejemplo anterior para que tambi√©n se ejecute `on` eventos de `pull_request`.

<GitHubActions2 />

Es importante limitar la ejecuci√≥n en `push` **s√≥lo** a las ramas seleccionadas (por ejemplo, `main`)
para evitar que los push a las ramas de PR se ejecuten dos veces!
De nuevo, esta soluci√≥n s√≥lo funciona si todas las PRs son del **mismo** repositorio.

Tambi√©n puede ser √∫til limitar las ejecuciones s√≥lo despu√©s de que se haya a√±adido una etiqueta espec√≠fica (por ejemplo, `benchmark`):

<GitHubActions3 />

Si planeas aceptar Pull Requests desde forks, como suele suceder en los proyectos de c√≥digo abierto p√∫blico,
entonces tendr√°s que manejar las cosas de una manera un poco diferente.
Por razones de seguridad, los secretos como tu `BENCHER_API_TOKEN` y el `GITHUB_TOKEN` no est√°n disponibles en GitHub Actions para PRs de forks.
Es decir, si un colaborador externo abre una PR desde un fork el ejemplo anterior no funcionar√°.
Hay tres opciones para las PRs de forks:

<ul>
  <li>[Benchmark PR branch desde la rama objetivo](#benchmark-pr-branch-from-target-branch)</li>
  <li>[Benchmark PR branch desde la rama objetivo con revisores requeridos](#benchmark-pr-branch-from-target-branch-with-required-reviewers)</li>
  <li>[Cache los resultados del benchmark de la rama PR y sube desde la rama por defecto](#cache-pr-benchmark-results)</li>
</ul>

### Benchmark PR Branch desde la Rama Objetivo

<GitHubActions4 />

1. Activa [en el evento `pull_request_target`](https://docs.github.com/es/actions/using-workflows/events-that-trigger-workflows#pull_request_target).
1. Haz checkout a la rama PR.
1. Ejecuta y sigue tus benchmarks de PR usando `bencher run` directamente.

Esto funciona porque `pull_request_target` se ejecuta en el contexto de la rama objetivo de la pull request,
donde se encuentran disponibles secretos como tu `BENCHER_API_TOKEN` y el `GITHUB_TOKEN`.
Por lo tanto, este workflow s√≥lo se ejecutar√° si existe en la rama objetivo.
Evita establecer secretos como variables de entorno, como `BENCHER_API_TOKEN`.
En su lugar, pasa expl√≠citamente el token API a `bencher run` (por ejemplo, `--token ${{ secrets.BENCHER_API_TOKEN }}`).
Consulta esta [publicaci√≥n del GitHub Security Lab](https://securitylab.github.com/research/github-actions-preventing-pwn-requests/)
y [este post](https://nathandavison.com/blog/github-actions-and-the-threat-of-malicious-pull-requests)
para obtener una visi√≥n completa sobre c√≥mo prevenir solicitudes pwn.

### Benchmark PR Branch desde la Rama Objetivo con Revisores Requeridos

<GitHubActions5 />

1. Activa [en el evento `pull_request_target`](https://docs.github.com/es/actions/using-workflows/events-that-trigger-workflows#pull_request_target).
1. Si la PR es `interna`, contin√∫a; si la PR es `externa`, espera una revisi√≥n requerida.
1. Haz checkout a la rama PR.
1. Ejecuta y sigue tus benchmarks de PR usando `bencher run` directamente.

Esta opci√≥n es exactamente la misma que [la opci√≥n anterior](#benchmark-pr-branch-from-target-branch)
excepto que `necesita` la aprobaci√≥n de un Revisor Requerido antes de cada ejecuci√≥n.
Para configurarlo, necesitar√°s [crear dos Ambientes de GitHub Action](https://docs.github.com/es/actions/deployment/targeting-different-environments/using-environments-for-deployment#using-an-environment)
(por ejemplo, `Repo -> Configuraci√≥n -> Ambientes -> Nuevo ambiente`).
El ambiente `interno` no requiere `Reglas de protecci√≥n de despliegue`.
Sin embargo, el ambiente `externo` deber√≠a tener `Revisores requeridos` establecidos para aquellos que se conf√≠a en que revisar√°n una PR antes del benchmarking.

Ten en cuenta que esto es diferente de la opci√≥n de etiqueta mencionada anteriormente para PRs internas.
La soluci√≥n basada en etiquetas ejecutar√° cualquier futuro trabajo despu√©s de ser etiquetado.
Esto puede ser √∫til si s√≥lo quieres evaluar ciertas PRs.
No obstante, las etiquetas no deben ser vistas como una medida de seguridad en s√≠ mismas.

La aprobaci√≥n basada en etiquetas puede limitarse a una √∫nica ejecuci√≥n restringiendo el `on: pull_request_target` a `types: [labeled]`.
Luego tendr√≠as que eliminar y volver a etiquetar la PR para cada aprobaci√≥n posterior.
En ese punto, simplemente est√°s recreando las `Reglas de protecci√≥n de despliegue` anteriores y llenando tu historial de PR.

### Cach√© los Resultados de Benchmark de la Rama PR

<GitHubActions6 />

1. Ejecuta tus benchmarks de PR en los eventos `pull_request`.
1. Guarda los resultados de los benchmarks de PR en un archivo y s√∫belos como un artefacto.
1. Sube el evento de PR como un artefacto.
1. Enlaza ese workflow con [el evento `workflow_run`](https://docs.github.com/es/actions/using-workflows/events-that-trigger-workflows#workflow_run).
1. Extrae los datos necesarios del evento de PR en cach√©.
1. Sigue los resultados de benchmark de PR en cach√© con `bencher run`.

Esto funciona porque `workflow_run` se ejecuta en el contexto de la rama por defecto del repositorio,
donde est√°n disponibles los secretos como tu `BENCHER_API_TOKEN` y el `GITHUB_TOKEN`.
Por lo tanto, estos workflows s√≥lo se ejecutar√°n si existen en la rama por defecto.
Consulta [usando datos del workflow que desencadena](https://docs.github.com/es/actions/using-workflows/events-that-trigger-workflows#using-data-from-the-triggering-workflow) para obtener una visi√≥n completa.
El n√∫mero de pull request, la rama principal, y la rama base utilizada en el workflow inicial deben ser expl√≠citamente pasadas ya que no est√°n disponibles dentro de `workflow_run`.

<br/>
<br/>

> üê∞ ¬°Felicidades! ¬°Has aprendido c√≥mo usar Bencher en GitHub Actions! üéâ

<br/>

<h2><a href="/docs/es/explanation/benchmarking">Contin√∫a: Resumen de Benchmarking ‚û°</a></h2>