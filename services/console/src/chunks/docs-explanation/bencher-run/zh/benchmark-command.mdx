import ShellForm from "../shell-form.mdx";
import ExecForm from "../exec-form.mdx";

## 基准命令

`bencher run` 的第一个参数是可选的基准命令。
这就是将被执行以调用你的基准测量工具（benchmark harness）的命令。
也可以通过环境变量 `BENCHER_CMD` 来设置此命令。
默认情况下，该命令在一个 shell 中执行，
可以使用 [`--shell`][shell option] 和 [`--flag`][flag option] 选项来配置。
其输出由一个[基准测量工具适配器][benchmark harness adapters]解析，
可以使用 [`--adapter`][adapter option] 选项来设置。
但是，如果基准测量工具将输出写入文件，那么还必须使用 [`--file`][file option] 选项来指定输出文件路径。
如果你想跟踪输出文件的大小（例如二进制大小）而不是其内容，
可以使用 [`--file-size`][file size option] 选项来指定输出文件路径。

如果你不希望在 shell 中执行该命令，可以使用 `--exec` 标志，
或者将命令的额外参数直接作为 `bencher run` 的额外参数提供。

Shell 表单：
<ShellForm />

Exec 表单：
<ExecForm />

可以使用 [`--iter`][iter option] 选项多次运行基准命令，
并可以使用 [`--fold`][fold option] 选项将这些结果合并为单个结果。
如果任何一次迭代失败，则整个命令将被视为失败，
除非设置了 [`--allow-failure`][allow failure flag] 标志。

如果未指定基准命令但指定了 [`--file`][file option] 选项，
那么 `bencher run` 将只从指定的输出文件路径读取。
类似地，如果未指定基准命令但指定了 [`--file-size`][file size option] 选项，
那么 `bencher run` 将只读取给定文件路径的文件大小。
`--file` 和 `--file-size` 选项都可以指定多次以读取多个文件。

<blockquote>
<details>
  <summary>🐰 使用 <code>-&#8288;-file</code> 选项的小贴士</summary>
  <code>-&#8288;-file</code> 选项可用于从文件读取基准结果。
  你可以多次指定 <code>-&#8288;-file</code> 选项以读取多个文件。
  如果你确实多次指定了 <code>-&#8288;-file</code> 选项，
  则每个文件都将被视为基准命令的一个单独 <code>iteration</code>。
  在显示时，这些结果会在不同的表格中展示。

  如果你希望将这些结果合并为单个 <code>iteration</code>，
  可以将 <code>-&#8288;-iter</code> 选项设置为 <code>1</code>，
  并将 <code>-&#8288;-fold</code> 选项设置为 <code>min</code>、<code>max</code> 或 <code>median</code> 聚合函数之一。
  这会将结果折叠为单个 <code>iteration</code>，
  并在单个表格中显示它们。
  请 <b>不要</b> 将 <code>-&#8288;-fold</code> 选项设置为 <code>mean</code>。
</details>
</blockquote>

如果既未指定基准命令，也未指定 [`--file`][file option] 选项，
或 [`--file-size`][file size option] 选项，
那么 `bencher run` 将改为从 `stdin` 读取。
这允许你将另一个命令的输出保存到文件或通过管道传入 `bencher run`。

[benchmark harness adapters]: /zh/docs/explanation/adapters/

[shell option]: #--shell-shell
[flag option]: #--flag-flag
[adapter option]: #--adapter-adapter
[file option]: #--file-file
[file size option]: #--file-size-file
[iter option]: #--iter-iter
[fold option]: #--fold-fold
[allow failure flag]: #--allow-failure