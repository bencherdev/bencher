---
title: "GitHub Actions"
description: "Bencher in GitHub Actions f√ºr kontinuierliches Benchmarking bei Pull Requests nutzen"
heading: "Wie man Bencher in GitHub Actions nutzt"
sortOrder: 3
---

import GitHubActions1 from "../../../chunks/how_to/github-actions.1.mdx";
import GitHubActions2 from "../../../chunks/how_to/github-actions.2.mdx";
import GitHubActions3 from "../../../chunks/how_to/github-actions.3.mdx";
import GitHubActions4 from "../../../chunks/how_to/github-actions.4.mdx";
import GitHubActions5 from "../../../chunks/how_to/github-actions.5.mdx";
import GitHubActions6 from "../../../chunks/how_to/github-actions.6.mdx";

<GitHubActions1 />

1. Erstellen Sie einen GitHub Actions `workflow` (z.B.: `.github/workflows/benchmark.yml`).
2. Spezifizieren Sie die Ereignisse, auf die der Workflow reagieren soll `on`. Siehe die [GitHub Actions `on` Dokumentation](https://docs.github.com/de/actions/using-workflows/workflow-syntax-for-github-actions#on) f√ºr einen vollst√§ndigen √úberblick. Dieser Workflow l√§uft **nur** bei `push` Ereignissen auf den `main` Branch. Zur Ausf√ºhrung [bei Pull Requests siehe den Abschnitt unten](#pull-requests).
3. Erstellen Sie eine GitHub Actions `job` (z.B.: `benchmark_with_bencher`)
4. Das Projekt muss bereits existieren. Setzen Sie die `--project` Flag oder die `BENCHER_PROJECT` Umgebungsvariable auf den Projektslug oder UUID. (z.B.: `BENCHER_PROJECT: save-walter-white`)
5. F√ºgen Sie `BENCHER_API_TOKEN` als **Repository** Geheimnis hinzu (z.B.: `Repo -> Einstellungen -> Geheimnisse und Variablen -> Aktionen -> Neues Repository-Geheimnis`)
6. Das API-Token muss bereits existieren. Setzen Sie die `--token` Flag oder die `BENCHER_API_TOKEN` Umgebungsvariable auf das API-Token. (z.B.: `BENCHER_API_TOKEN: ${{ secrets.BENCHER_API_TOKEN }}`)
7. Optional: Setzen Sie die `--adapter` Flag oder die `BENCHER_ADAPTER` Umgebungsvariable auf den gew√ºnschten Adapternamen. Wenn dies nicht eingestellt ist, wird der `magic` Adapter verwendet. Siehe [Benchmark-Kabelbaumadapter](/docs/de/explanation/adapters) f√ºr einen vollst√§ndigen √úberblick. (z.B.: `BENCHER_ADAPTER: json`)
8. Optional: Setzen Sie die `--testbed` Flag oder die `BENCHER_TESTBED` Umgebungsvariable auf den Testbed Slug oder UUID. Das Testbed **muss** bereits existieren. Wenn dies nicht eingestellt ist, wird das `localhost` Testbed verwendet. (z.B.: `BENCHER_TESTBED: ubuntu-latest`)
9. Checken Sie Ihren Quellcode aus. (z.B.: `uses: actions/checkout@v3`)
10. Installieren Sie die Bencher CLI mit der [GitHub Action](https://github.com/marketplace/actions/bencher-cli). (z.B.: `uses: bencherdev/bencher@main`)
11. [Verfolgen Sie Ihre Benchmarks](/docs/de/how-to/track-benchmarks) mit dem <code><a href="/docs/de/explanation/bencher-run">bencher run</a></code> CLI-Unterbefehl:
    1. Es gibt mehrere M√∂glichkeiten, den Projektbranch festzulegen. Siehe [Branch-Auswahl](/docs/de/how-to/branch-selection) f√ºr einen vollst√§ndigen √úberblick. Der bereitgestellte Befehl verwendet [standardm√§√üige Umgebungsvariablen von GitHub Actions](https://docs.github.com/de/actions/learn-github-actions/variables#default-environment-variables) und versucht:
        1. Die aktuellen Branch-Daten zu verwenden, wenn sie bereits existieren. (z.B.: `--if-branch "$GITHUB_REF_NAME"`)
        2. Erstellt eine Kopie der PR-Zielbranch-Daten und -Schwellenwerte, wenn diese bereits existieren. (z.B.: `--else-if-branch "$GITHUB_BASE_REF"`)
        3. Andernfalls erstellen Sie eine Kopie der `main` Branch-Daten und -Schwellenwerte. (z.B.: `--else-if-branch main`)
    2. Stellen Sie den Befehl so ein, dass er bei Erstellung eines Alerts fehlschl√§gt. Damit ein Alert erstellt wird, muss bereits eine [Schwelle](/docs/de/explanation/thresholds) existieren. (z.B.: `--err`)
    3. Setzen Sie das GitHub API-Authentifizierungstoken (z.B.: `--github-actions ${{ secrets.GITHUB_TOKEN }}`). Wenn diese Option als Teil eines Pull-Antrags gesetzt ist, werden die Ergebnisse als Kommentar zum Pull-Antrag hinzugef√ºgt. Der bereitgestellte Befehl verwendet [die GitHub Actions `GITHUB_TOKEN` Umgebungsvariable](https://docs.github.com/de/actions/security-guides/automatic-token-authentication).
    4. F√ºhren Sie Ihre Benchmarks aus und generieren Sie einen Bericht aus den Ergebnissen. (z.B.: `"bencher mock"`)

<br/>

## Pull Requests

Um Leistungsregressionen in Pull Requests zu erkennen, m√ºssen Sie Ihre Benchmarks bei PRs durchf√ºhren.
Wenn Sie nur erwarten, PRs von Branches innerhalb desselben Repositories zu haben, k√∂nnen Sie einfach das obige Beispiel √§ndern, um auch `on` `pull_request` Ereignissen zu laufen.

<GitHubActions2 />

Es ist wichtig, den Lauf bei `push` **nur** auf ausgew√§hlte Branches (z.B.: `main`)
zu beschr√§nken, um zu verhindern, dass Pushes zu PR-Branches zweimal ausgef√ºhrt werden!
Nochmals, diese L√∂sung funktioniert nur, wenn alle PRs aus dem **gleichen** Repository stammen.

Es kann auch gut sein, L√§ufe nur zu beschr√§nken, nachdem ein bestimmtes Label hinzugef√ºgt wurde (z.B.: `benchmark`):

<GitHubActions3 />

Wenn Sie planen, Pull Requests von Forks zu akzeptieren, wie es oft in √∂ffentlichen Open-Source-Projekten der Fall ist,
dann m√ºssen Sie die Dinge ein wenig anders handhaben.
Aus Sicherheitsgr√ºnden sind Geheimnisse wie Ihr `BENCHER_API_TOKEN` und das `GITHUB_TOKEN` in GitHub Actions f√ºr Fork PRs nicht verf√ºgbar.
Das bedeutet, wenn ein externer Mitwirkender einen PR von einem Fork √∂ffnet, wird das obige Beispiel nicht funktionieren.
Es gibt drei Optionen f√ºr Fork PRs:

<ul>
  <li>[Benchmark PR Branch vom Ziel Branch](#benchmark-pr-branch-from-target-branch)</li>
  <li>[Benchmark PR Branch vom Ziel Branch mit erforderlichen √úberpr√ºfern](#benchmark-pr-branch-from-target-branch-with-required-reviewers)</li>
  <li>[Cache PR Branch Benchmark Ergebnisse und Hochladen vom Standard Branch](#cache-pr-benchmark-results)</li>
</ul>

### Benchmark PR Branch vom Ziel Branch

<GitHubActions4 />

1. Ausl√∂sen [bei dem `pull_request_target` Ereignis](https://docs.github.com/de/actions/using-workflows/events-that-trigger-workflows#pull_request_target).
1. Pr√ºfen Sie den PR-Branch aus.
1. F√ºhren Sie Ihre PR-Benchmarks aus und verfolgen Sie diese direkt mit `bencher run`.

Dies funktioniert, weil `pull_request_target` im Kontext des Zielbranches des Pull Requests ausgef√ºhrt wird,
wo Geheimnisse wie Ihr `BENCHER_API_TOKEN` und das `GITHUB_TOKEN` verf√ºgbar sind.
Daher wird dieser Workflow nur ausgef√ºhrt, wenn er auf dem Zielbranch existiert.
Vermeiden Sie es, Geheimnisse als Umgebungsvariablen zu setzen, wie `BENCHER_API_TOKEN`.
Stattdessen geben Sie das API-Token explizit an `bencher run` weiter (z.B.: `--token ${{ secrets.BENCHER_API_TOKEN }}`).
Siehe diese [GitHub Security Lab Aufschreibung](https://securitylab.github.com/research/github-actions-preventing-pwn-requests/)
und [diesen Blogpost](https://nathandavison.com/blog/github-actions-and-the-threat-of-malicious-pull-requests)
√ºber das Verhindern von Pwn-Anfragen f√ºr einen vollst√§ndigen √úberblick.

### Benchmark PR Branch vom Ziel Branch mit erforderlichen √úberpr√ºfern

<GitHubActions5 />

1. Ausl√∂sen [bei dem `pull_request_target` Ereignis](https://docs.github.com/de/actions/using-workflows/events-that-trigger-workflows#pull_request_target).
1. Wenn der PR `intern` ist, dann fahren Sie fort; wenn der PR `extern` ist, warten Sie auf eine erforderliche √úberpr√ºfung.
1. Pr√ºfen Sie den PR-Branch aus.
1. F√ºhren Sie Ihre PR-Benchmarks aus und verfolgen Sie diese direkt mit `bencher run`.

Diese Option ist genau dieselbe wie [die vorherige Option](#benchmark-pr-branch-from-target-branch)
au√üer sie `ben√∂tigt` die Zustimmung eines erforderlichen √úberpr√ºfers vor jedem Lauf.
Um dies einzurichten, m√ºssen Sie [zwei GitHub Action-Umgebungen erstellen](https://docs.github.com/de/actions/deployment/targeting-different-environments/using-environments-for-deployment#using-an-environment)
(z.B.: `Repo -> Einstellungen -> Umgebungen -> Neue Umgebung`).
Die `intern` Umgebung erfordert keine `Bereitstellungsschutzregeln`.
Die `extern` Umgebung sollte jedoch `Erforderliche √úberpr√ºfer` festgelegt haben, denen vertraut wird, einen PR vor dem Benchmarking zu √ºberpr√ºfen.

Bitte beachten Sie, dass dies anders ist als die oben aufgef√ºhrte Tag-Option f√ºr interne PRs.
Die tag-basierte L√∂sung wird _jeden_ zuk√ºnftigen Job nach der Markierung ausf√ºhren.
Dies kann n√ºtzlich sein, wenn Sie nur bestimmte PRs benchmarken m√∂chten.
Markierungen sollten jedoch nicht als Sicherheitsma√ünahme betrachtet werden.

Die auf Tags basierende Zulassung kann auf einen einzigen Durchlauf beschr√§nkt werden, indem das `on: pull_request_target` auf `types: [labeled]` beschr√§nkt wird.
Sie m√ºssten dann den PR entfernen und neu markieren f√ºr jede nachfolgende Freigabe.
Auf diesen Punkt sind Sie nur die `Bereitstellungsschutzregeln` reproduktiv und cluttering up ihr PR-Geschichte.

### Cache PR Benchmark Ergebnisse

<GitHubActions6 />

1. F√ºhren Sie Ihre PR-Benchmarks bei `pull_request` Ereignissen aus.
1. Speichern Sie die PR Benchmark-Ergebnisse in einer Datei und laden Sie diese als ein Artefakt hoch.
1. Laden Sie das PR Ereignis als Artefakt hoch.
1. Verkn√ºpfen Sie diesen Workflow mit [dem `workflow_run` Ereignis](https://docs.github.com/de/actions/using-workflows/events-that-trigger-workflows#workflow_run).
1. Extrahieren Sie notwendige Daten aus dem zwischengespeicherten PR Ereignis.
1. Verfolgen Sie die zwischengespeicherten PR Benchmark-Ergebnisse mit `bencher run`.

Das funktioniert, weil `workflow_run` im Kontext des Standardbranches des Repositorys l√§uft,
wo Geheimnisse wie Ihr `BENCHER_API_TOKEN` und das `GITHUB_TOKEN` verf√ºgbar sind.
Daher werden diese Abl√§ufe nur ausgef√ºhrt, wenn sie auf dem Standardbranch existieren.
Sehen Sie [die Verwendung von Daten aus dem ausl√∂senden Workflow](https://docs.github.com/de/actions/using-workflows/events-that-trigger-workflows#using-data-from-the-triggering-workflow) f√ºr einen vollst√§ndigen √úberblick.
Die Pull Request Nummer, der Kopfzweig und der Basiszweig, die im anf√§nglichen Workflow verwendet wurden, m√ºssen ausdr√ºcklich weitergegeben werden, da sie innerhalb von `workflow_run` nicht verf√ºgbar sind.

<br/>
<br/>

> üê∞ Herzlichen Gl√ºckwunsch! Sie haben gelernt, wie man Bencher in GitHub Actions verwendet!üéâ

<br/>

<h2><a href="/docs/de/explanation/benchmarking">Weiter geht's: √úbersicht √ºber die Leistungsmessung ‚û°</a></h2>