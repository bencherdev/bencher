import TestbedCreate from "../testbed-create.mdx";
import GitCheckoutMain from "../git-checkout-main.mdx";
import RunMainRelative from "../run-main-relative.mdx";
import ThresholdCreateRelative from "../threshold-create-relative.mdx";
import GitCheckoutFeature from "../git-checkout-feature.mdx";
import RunFeatureRelative from "../run-feature-relative.mdx";

## Benchmarking Cont√≠nuo Relativo

Continuando de onde paramos nos tutoriais [In√≠cio R√°pido][quick start] e [Docker Auto Hospedado][docker self-hosted], vamos adicionar o Benchmarking Cont√≠nuo Relativo ao nosso projeto `Salve Walter White`.

> üê∞ Certifique-se de ter
> [criado um token de API e configurado como a vari√°vel de ambiente `BENCHER_API_TOKEN`][create an api token]
> antes de continuar!

Primeiro, precisamos criar um novo Testbed para representar nossos executores CI, apropriadamente chamado de `ci-runner`.

<TestbedCreate />

1. Use o subcomando CLI `bencher testbed create`.
   Veja [a documenta√ß√£o `testbed create`][testbed create] para mais detalhes.
   (ex: `bencher testbed create`)
2. Defina a op√ß√£o `--name` para o nome desejado do Testbed.
   (ex: `--name ci-runner`)
3. Especifique o argumento do projeto como o slug do projeto `Salve Walter White`.
   (ex: `save-walter-white-1234abcd`)

O Benchmarking Cont√≠nuo Relativo executa uma compara√ß√£o lado a lado de duas vers√µes do seu c√≥digo.
Isso pode ser √∫til ao lidar com ambientes de CI/CD ruidosos,
onde os recursos dispon√≠veis podem ser altamente vari√°veis entre as execu√ß√µes.
Neste exemplo, estaremos comparando os resultados da execu√ß√£o na branch `main`
com os resultados de execu√ß√£o em uma branch de recurso chamada `feature-branch`.
Como cada ambiente de CI √© um pouco diferente,
o seguinte exemplo destina-se a ser mais ilustrativo do que pr√°tico.
Para exemplos mais espec√≠ficos, veja [Benchmarking Cont√≠nuo no GitHub Actions][github actions]
e [Benchmarking Cont√≠nuo no GitLab CI/CD][gitlab ci/cd].

Primeiro, precisamos fazer checkout da branch `main` com `git` no CI:

<GitCheckoutMain />

Em seguida, precisamos executar nossos benchmarks na branch `main` no CI:

<RunMainRelative />

1. Use o subcomando CLI <code><a href="/pt/docs/explanation/bencher-run/">bencher run</a></code>
   para executar seus benchmarks na branch `main`.
   Veja [o subcomando CLI `bencher run`][bencher run] para uma vis√£o completa.
   (ex: `bencher run`)
2. Defina a op√ß√£o `--project` para o slug do Projeto.
   Veja [a documenta√ß√£o `--project`][project option] para mais detalhes.
   (ex: `--project save-walter-white-1234abcd`)
3. Defina a op√ß√£o `--branch` para o nome da branch de recurso.
   Veja [sele√ß√£o de branch][branch selection branch] para uma vis√£o completa.
   (ex: `--branch feature-branch`)
4. Defina a flag `--branch-reset`.
   Veja [sele√ß√£o de branch][branch selection reset] para uma vis√£o completa.
   (ex: `--branch-reset`)
5. Defina a op√ß√£o `--testbed` para o nome do Testbed.
   Veja [a documenta√ß√£o `--testbed`][testbed option] para mais detalhes.
   (ex: `--testbed ci-runner`)
6. Defina a op√ß√£o `--adapter` para o adaptador de harness de benchmark desejado.
   Veja [adaptadores de harness de benchmark][adapters] para uma vis√£o completa.
   (ex: `--adapter json`)
7.  Especifique os argumentos do comando de benchmark.
    Veja [comando de benchmark][command argument] para uma vis√£o completa.
    (ex: `bencher mock`)

A primeira vez que este comando √© executado no CI,
criar√° a branch `feature-branch` j√° que ela ainda n√£o existe.
A nova `feature-branch` _n√£o_ ter√° um ponto de partida, dados existentes ou Limiares.
Nas execu√ß√µes subsequentes, a vers√£o antiga da `feature-branch` ser√° renomeada
e uma nova `feature-branch` ser√° criada sem um ponto de partida, dados existentes ou Limiares.

Em seguida, precisamos criar um novo [Limiar][thresholds] no CI para nossa nova branch `feature-branch`:

<ThresholdCreateRelative />

1. Use o subcomando CLI `bencher threshold create`.
   Veja [a documenta√ß√£o `threshold create`][threshold create] para mais detalhes.
   (ex: `bencher threshold create`)
2. Defina a op√ß√£o `--branch` para a nova branch `feature-branch`.
   (ex: `--branch feature-branch`)
3. Defina a op√ß√£o `--branch` para o Testbed `ci-runner`.
   (ex: `--testbed ci-runner`)
4. Defina a op√ß√£o `--measure` para a Medida `Lat√™ncia` gerada por `bencher mock`.
   Veja [a defini√ß√£o de Medida][measure] para detalhes.
   (ex: `--measure Latency`)
5. Defina a op√ß√£o `--test` para um Limiar de `porcentagem`.
   Veja [Limiares & Alertas][percentage] para uma vis√£o completa.
   (ex: `--test t-test`)
6. Defina a op√ß√£o `--upper-boundary` para um Limite Superior de `0.25` (ou seja, `25%`).
   Veja [Limiares & Alertas][percentage upper boundary] para uma vis√£o completa.
   (ex: `--upper-boundary 0.25`)
7. Especifique o argumento do projeto como o slug do projeto `Salve Walter White`.
   (ex: `save-walter-white-1234abcd`)

Ent√£o, precisamos fazer checkout da branch `feature-branch` com `git` no CI:

<GitCheckoutFeature />

Finalmente, estamos prontos para executar nossos benchmarks da `feature-branch` no CI:

<RunFeatureRelative />

1. Use o subcomando CLI <code><a href="/pt/docs/explanation/bencher-run/">bencher run</a></code>
   para executar seus benchmarks da `feature-branch`.
   Veja [o subcomando CLI `bencher run`][bencher run] para uma vis√£o completa.
   (ex: `bencher run`)
2. Defina a op√ß√£o `--project` para o slug do Projeto.
   Veja [a documenta√ß√£o `--project`][project option] para mais detalhes.
   (ex: `--project save-walter-white-1234abcd`)
3. Defina a op√ß√£o `--branch` para o nome da branch de recurso.
   Veja [sele√ß√£o de branch][branch selection branch] para uma vis√£o completa.
   (ex: `--branch feature-branch`)
4. Defina a op√ß√£o `--testbed` para o nome do Testbed.
   Veja [a documenta√ß√£o `--testbed`][testbed option] para mais detalhes.
   (ex: `--testbed ci-runner`)
5. Defina a op√ß√£o `--adapter` para o adaptador de harness de benchmark desejado.
   Veja [adaptadores de harness de benchmark][adapters] para uma vis√£o completa.
   (ex: `--adapter json`)
6. Defina a flag `--err` para falhar o comando se um Alerta for gerado.
   Veja [Limiar & Alertas][alerts] para uma vis√£o completa.
   (ex: `--err`)
7. Especifique os argumentos do comando de benchmark.
   Veja [comando de benchmark][command argument] para uma vis√£o completa.
   (ex: `bencher mock`)

Toda vez que este comando for executado no CI,
estar√° comparando os resultados da `feature-branch` apenas com os resultados mais recentes da `main`.

[quick start]: /pt/docs/tutorial/quick-start/
[docker self-hosted]: /pt/docs/tutorial/docker/
[continuous benchmarking]: /pt/docs/explanation/continuous-benchmarking/
[create an api token]: /pt/docs/tutorial/quick-start/#create-an-api-token
[testbed create]: /pt/docs/api/projects/testbeds/#post-v0projectsprojecttestbeds
[github actions]: /pt/docs/how-to/github-actions/
[gitlab ci/cd]: /pt/docs/how-to/gitlab-ci-cd/
[bencher run]: /pt/docs/explanation/bencher-run/
[project option]: /pt/docs/explanation/bencher-run/#--project-project
[branch selection branch]: /pt/docs/explanation/branch-selection/#--branch-branch
[branch selection reset]: /pt/docs/explanation/branch-selection/#--branch-reset
[testbed option]: /pt/docs/explanation/bencher-run/#--testbed-testbed
[adapters]: /pt/docs/explanation/adapters/
[command argument]: /pt/docs/explanation/bencher-run/#benchmark-command
[thresholds]: /pt/docs/explanation/thresholds/
[threshold create]: /pt/docs/api/projects/thresholds/#post-v0projectsprojectthresholds
[measure]: /pt/docs/explanation/benchmarking/#measures
[percentage]: /pt/docs/explanation/thresholds/#percentage-thresholds
[percentage upper boundary]: /pt/docs/explanation/thresholds/#percentage-threshold-upper-boundary
[alerts]: /pt/docs/explanation/thresholds/#alerts