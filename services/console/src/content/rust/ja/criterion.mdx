---
title: "Criterion"
description: "Criterionã‚’ä½¿ç”¨ã—ã¦Rustã‚³ãƒ¼ãƒ‰ã‚’ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã™ã‚‹æ–¹æ³•ã«ã¤ã„ã¦ã®ã‚¹ãƒ†ãƒƒãƒ—ãƒã‚¤ã‚¹ãƒ†ãƒƒãƒ—ã‚¬ã‚¤ãƒ‰"
heading: "Criterionã‚’ä½¿ã£ã¦Rustã‚³ãƒ¼ãƒ‰ã‚’ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã™ã‚‹æ–¹æ³•"
sortOrder: 2
---

import Benchmarking from "../../../chunks/benchmarking/ja/benchmarking.mdx";
import FizzBuzzRules from "../../../chunks/benchmarking/ja/fizz-buzz-rules.mdx";
import FizzBuzzRust from "../../../chunks/rust/ja/fizz-buzz-rust.mdx";
import StepByStepRust from "../../../chunks/rust/ja/step-by-step-rust.mdx";
import MicroVsMacro from "../../../chunks/benchmarking/ja/micro-vs-macro.mdx";
import BenchmarkingRust from "../../../chunks/rust/ja/benchmarking-rust.mdx";
import FizzBuzzRefactor from "../../../chunks/rust/criterion/ja/fizz-buzz-refactor.mdx";
import GameBenchesTree from "../../../chunks/rust/criterion/game-benches-tree.mdx";
import FizzBuzzRefactorBenchesCode from "../../../chunks/rust/criterion/fizz-buzz-refactor-benches-code.mdx";
import GameCargoToml from "../../../chunks/rust/criterion/game-cargo-toml.mdx";
import BenchPlayGameOutput from "../../../chunks/rust/criterion/bench-play-game-output.mdx";
import FizzBuzzFibonacciRust from "../../../chunks/rust/ja/fizz-buzz-fibonacci-rust.mdx";
import PlayGameRustCode from "../../../chunks/rust/criterion/play-game-rust-code.mdx";
import BenchPlayGameFibonacciOutput from "../../../chunks/rust/criterion/bench-play-game-fibonacci-output.mdx";
import FizzBuzzFibonacciOpenRust from "../../../chunks/rust/ja/fizz-buzz-fibonacci-open-rust.mdx";
import FizzBuzzFibonacciOpenRustCode from "../../../chunks/rust/criterion/fizz-buzz-fibonacci-open-rust-code.mdx";
import TheEnd from "../../../chunks/benchmarking/ja/the-end.mdx";
import OnFire from "../../../chunks/benchmarking/ja/on-fire.mdx";
import BenchPlayGameOnFireCode from "../../../chunks/rust/criterion/bench-play-game-on-fire-code.mdx";
import BenchPlayGameOnFireOutputStart from "../../../chunks/rust/criterion/bench-play-game-on-fire-output-start.mdx";
import BenchPlayGameOnFireOutput from "../../../chunks/rust/criterion/bench-play-game-on-fire-output.mdx";
import FizzBuzzFibonacciFixRust from "../../../chunks/rust/ja/fizz-buzz-fibonacci-fix-rust.mdx";
import BenchPlayGameFixOutput from "../../../chunks/rust/criterion/bench-play-game-fix-output.mdx";
import CatchInCi from "../../../chunks/benchmarking/ja/catch-in-ci.mdx";
import CatchInCiOutput from "../../../chunks/rust/criterion/catch-in-ci-output.mdx";
import CatchInCiPlot from "../../../chunks/benchmarking/ja/catch-in-ci-plot.mdx";
import CatchInCiPlotRustBench from "../../../chunks/rust/catch-in-ci-plot-rust-bench.mdx";
import BencherFooter from "../../../chunks/learn/ja/bencher-footer.mdx";

<Benchmarking />

<FizzBuzzRust />

<StepByStepRust />

<MicroVsMacro />

<BenchmarkingRust />

å…¨ã¦ãŒ[Bencherã«ã‚ˆã£ã¦ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã™](/docs/ja/explanation/adapters/)ã€‚ãã‚Œãªã‚‰ã°ãªãœCriterionã‚’é¸ã¶ã®ã§ã—ã‚‡ã†ã‹ï¼Ÿ
Criterionã¯ã€Rustã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã«ãŠã‘ã‚‹äº‹å®Ÿä¸Šã®æ¨™æº–ãƒ™ãƒ³ãƒãƒãƒ¼ã‚­ãƒ³ã‚°ãƒãƒ¼ãƒã‚¹ã§ã™ã€‚
ç§ã¯ã€ã‚³ãƒ¼ãƒ‰ã®ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ã‚’ãƒ™ãƒ³ãƒãƒãƒ¼ã‚­ãƒ³ã‚°ã™ã‚‹ãŸã‚ã«Criterionã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚
ã¤ã¾ã‚Šã€Criterionã¯å£æ™‚è¨ˆæ™‚é–“ã®æ¸¬å®šã«é©ã—ã¦ã„ã¾ã™ã€‚

<FizzBuzzRefactor />

## FizzBuzzã®ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯

ã‚³ãƒ¼ãƒ‰ã‚’ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã™ã‚‹ãŸã‚ã«ã€`benches` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã—ã€ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã‚’å«ã‚€ãƒ•ã‚¡ã‚¤ãƒ« `play_game.rs` ã‚’è¿½åŠ ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼š

<GameBenchesTree />

`play_game.rs` ã«æ¬¡ã®ã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ ã—ã¾ã™ï¼š

<FizzBuzzRefactorBenchesCode />

- `Criterion` ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ãƒ©ãƒ³ãƒŠãƒ¼ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã™ã€‚
- æˆ‘ã€…ã® `game` ã‚¯ãƒ¬ãƒ¼ãƒˆã‹ã‚‰ `play_game` é–¢æ•°ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã™ã€‚
- `Criterion` ã® mutable reference ã‚’å—ã‘å–ã‚‹ `bench_play_game` ã¨ã„ã†åå‰ã®é–¢æ•°ã‚’ä½œæˆã—ã¾ã™ã€‚
- `Criterion` ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ï¼ˆ`c`ï¼‰ã‚’ä½¿ç”¨ã—ã¦ã€ `bench_play_game` ã¨ã„ã†åå‰ã®ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã‚’ä½œæˆã—ã¾ã™ã€‚
- ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ãƒ©ãƒ³ãƒŠãƒ¼ï¼ˆ`b`ï¼‰ã‚’ä½¿ç”¨ã—ã¦ã€ãƒã‚¯ãƒ­ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã‚’ä½•åº¦ã‚‚å®Ÿè¡Œã—ã¾ã™ã€‚
- ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãŒæˆ‘ã€…ã®ã‚³ãƒ¼ãƒ‰ã‚’æœ€é©åŒ–ã—ãªã„ã‚ˆã†ã«ã€"black box" å†…ã§ãƒã‚¯ãƒ­ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚
- `1` ã‹ã‚‰ `100` ã¾ã§ç¹°ã‚Šè¿”ã—ã¾ã™ã€‚
- å„æ•°å­—ã«å¯¾ã—ã¦ã€`play_game` ã‚’å‘¼ã³å‡ºã—ã¾ã™ã€‚`print` ã‚’ `false` ã«è¨­å®šã—ã¾ã™ã€‚

æ¬¡ã«ã€ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã® `game` ã‚¯ãƒ¬ãƒ¼ãƒˆã‚’è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

ã‚ãªãŸã® `Cargo.toml` ãƒ•ã‚¡ã‚¤ãƒ«ã® _æœ€å¾Œ_ ã«ã€ä»¥ä¸‹ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ï¼š

<GameCargoToml />

- `criterion`: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆã®ãŸã‚ã«ã®ã¿ä½¿ç”¨ã™ã‚‹ã®ã§ã€é–‹ç™ºä¾å­˜é–¢ä¿‚ã¨ã—ã¦ `criterion` ã‚’è¿½åŠ ã—ã¾ã™ã€‚
- `bench`: `play_game` ã‚’ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã¨ã—ã¦ç™»éŒ²ã—ã€`harness` ã‚’ `false` ã«è¨­å®šã—ã¾ã™ã€‚ãªãœãªã‚‰ã€æˆ‘ã€…ã¯ Criterion ã‚’ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ãƒãƒ¼ãƒã‚¹ã¨ã—ã¦ä½¿ç”¨ã™ã‚‹ã‹ã‚‰ã§ã™ã€‚

ã•ã‚ã€ã‚³ãƒ¼ãƒ‰ã‚’ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã™ã‚‹æº–å‚™ãŒæ•´ã„ã¾ã—ãŸã€‚`cargo bench` ã‚’å®Ÿè¡Œã—ã¾ã™:

<BenchPlayGameOutput />

> ğŸ° ãƒ¬ã‚¿ã‚¹ã‚¿ãƒ¼ãƒ‹ãƒƒãƒ—ãƒ“ãƒ¼ãƒˆï¼ç§ãŸã¡ã¯æœ€åˆã®ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’å¾—ã¾ã—ãŸï¼

ã¤ã„ã«...ã¡ã‚‡ã£ã¨å¾…ã£ã¦ã€ç§ãŸã¡ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯æ–°æ©Ÿèƒ½ã‚’æ±‚ã‚ã¦ã„ã¾ã™ï¼

<FizzBuzzFibonacciRust>
  <PlayGameRustCode />
</FizzBuzzFibonacciRust>

## FizzBuzzFibonacciã®ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯

ã“ã“ã§ã€ç§ãŸã¡ã¯ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã‚’å†å®Ÿè¡Œã§ãã¾ã™ï¼š

<BenchPlayGameFibonacciOutput />

ãŠãŠã€ã™ã”ã„ï¼Criterionã¯ã€ç§ãŸã¡ã®FizzBuzzã¨FizzBuzzFibonacciã‚²ãƒ¼ãƒ ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®é•ã„ã‚’`+568.69%`ã¨æ•™ãˆã¦ãã‚Œã¾ã—ãŸã€‚
ã‚ãªãŸã®æ•°å­—ã¯ç§ã®ã‚‚ã®ã¨å°‘ã—é•ã†ã§ã—ã‚‡ã†ã€‚
ã—ã‹ã—ã€2ã¤ã®ã‚²ãƒ¼ãƒ ã®é•ã„ã¯ãŠãã‚‰ã`5x`ã®ç¯„å›²å†…ã§ã—ã‚‡ã†ã€‚
ã“ã‚Œã¯ç§ã«ã¨ã£ã¦ã¯è‰¯ã„æ„Ÿã˜ã§ã™ï¼ç‰¹ã«ã€ç§ãŸã¡ã®ã‚²ãƒ¼ãƒ ã«_Fibonacci_ã¨ã„ã†é«˜å°šãªéŸ¿ãã®ãƒ•ã‚£ãƒ¼ãƒãƒ£ãƒ¼ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã«ã‚ˆã‚‹ã‚‚ã®ã§ã™ã€‚
å­ä¾›ãŸã¡ã¯ãã‚Œã‚’å¤§å¥½ãã«ãªã‚‹ã§ã—ã‚‡ã†ï¼

<FizzBuzzFibonacciOpenRust>
  <FizzBuzzFibonacciOpenRustCode />
</FizzBuzzFibonacciOpenRust>

<TheEnd />

<br />

<OnFire />

<BenchPlayGameOnFireCode />

- ã‚²ãƒ¼ãƒ ã‚’æ•°å­—ä¸€ç™¾ï¼ˆ`100`ï¼‰ã§ãƒ—ãƒ¬ã‚¤ã™ã‚‹ãŸã‚ã®ãƒã‚¤ã‚¯ãƒ­ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ `bench_play_game_100`
- ã‚²ãƒ¼ãƒ ã‚’æ•°å­—ä¸€ç™¾ä¸‡ï¼ˆ`1_000_000`ï¼‰ã§ãƒ—ãƒ¬ã‚¤ã™ã‚‹ãŸã‚ã®ãƒã‚¤ã‚¯ãƒ­ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ `bench_play_game_1_000_000`

ç§ãŒãã‚Œã‚’å®Ÿè¡Œã—ãŸã¨ãã€ã“ã‚Œã‚’å¾—ã¾ã—ãŸï¼š

<BenchPlayGameOnFireOutputStart />

ãã‚Œã‚’å¾…ã£ã¦...ãã‚Œã‚’å¾…ã£ã¦...

<BenchPlayGameOnFireOutput />

ä½•ï¼`403.57 ns` x `1,000` ã¯ `403,570 ns` ã«ãªã‚‹ã¹ãã§ã€`9,596,800 ns` ï¼ˆ`9.5968 ms` x `1_000_000 ns/1 ms`ï¼‰ã«ã¯ãªã‚‰ãªã„ã¯ãšã§ã™ ğŸ¤¯
ç§ãŒãƒ•ã‚£ãƒœãƒŠãƒƒãƒæ•°åˆ—ã‚³ãƒ¼ãƒ‰ã‚’æ©Ÿèƒ½çš„ã«æ­£ã—ãå®Ÿè£…ã—ãŸã«ã‚‚ã‹ã‹ã‚ã‚‰ãšã€ã©ã“ã‹ã«ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®ãƒã‚°ãŒã‚ã‚‹ã¯ãšã§ã™ã€‚

<FizzBuzzFibonacciFixRust />

ãã‚Œã§ã¯ã€ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã‚’å†å®Ÿè¡Œã—ã€ã©ã†ãªã£ãŸã‹è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

<BenchPlayGameFixOutput />

ãŠãŠã€ãƒ¯ ã‚ªï¼ç§ãŸã¡ã® `bench_play_game` ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã¯ã€å…ƒã®FizzBuzzã®ã¨ãã®ã‚‚ã®ã¨åŒã˜ãã‚‰ã„ã«æˆ»ã£ã¦ãã¾ã—ãŸã€‚
ãã®ã‚¹ã‚³ã‚¢ãŒã‚‚ã¨ã‚‚ã¨ã©ã‚Œãã‚‰ã„ã ã£ãŸã‹è¦šãˆã¦ã„ã‚‰ã‚Œã‚Œã°è‰¯ã‹ã£ãŸã®ã§ã™ãŒã€ã‚‚ã†3é€±é–“ã‚‚çµŒã£ã¦ã„ã¾ã™ã€‚
ç§ã®ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã®å±¥æ­´ã¯ãã“ã¾ã§é¡ã‚‹ã“ã¨ãŒã§ãã¾ã›ã‚“ã€‚
ã¾ãŸã€Criterionã¯æœ€æ–°ã®çµæœã«ã¤ã„ã¦ã—ã‹æ¯”è¼ƒã—ã¾ã›ã‚“ã€‚
ã—ã‹ã—ã€ãã‚Œã¯è¿‘ã„ã¨æ€ã„ã¾ã™ï¼

`bench_play_game_100` ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã¯ã»ã¼10å€ä¸‹ãŒã‚Šã¾ã—ãŸã€‚ `-93.950%`ã€‚
ãã—ã¦ `bench_play_game_1_000_000` ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã¯10,000å€ä»¥ä¸Šä¸‹ãŒã‚Šã¾ã—ãŸï¼ `9,596,800 ns` ã‹ã‚‰ `30.403 ns` ã«ï¼
ç§ãŸã¡ã¯ã•ãˆã‚‚Criterionã®å¤‰åŒ–ã®ãƒ¡ãƒ¼ã‚¿ãƒ¼ã‚’æœ€å¤§ã¾ã§æŒ¯ã‚Šåˆ‡ã‚Šã¾ã—ãŸã€ãã‚Œã¯ `-100.000%` ã¾ã§ã—ã‹è¡¨ç¤ºã—ã¾ã›ã‚“ï¼

> ğŸ° ã­ãˆã€å°‘ãªãã¨ã‚‚ç§ãŸã¡ã¯ã“ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒã‚°ã‚’æœ¬ç•ªç’°å¢ƒã«é€²å‡ºã™ã‚‹å‰ã«æ•ã¾ãˆãŸ...ã‚ã‚ã€ãã†ã ã£ãŸ...

<CatchInCi />

<CatchInCiOutput />

<CatchInCiPlot />

<CatchInCiPlotRustBench title="Criterionã§Rustã‚’ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã™ã‚‹æ–¹æ³•" />

<BencherFooter />
