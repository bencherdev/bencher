---
title: "GitHub Actions"
description: "Usa Bencher en GitHub Actions para establecer un marcado continuo en los pull requests"
heading: "C√≥mo usar Bencher en GitHub Actions"
sortOrder: 3
---

import GitHubActions1 from "../../../chunks/how_to/github-actions.1.mdx";
import GitHubActions2 from "../../../chunks/how_to/github-actions.2.mdx";
import GitHubActions4 from "../../../chunks/how_to/github-actions.4.mdx";
import GitHubActions5 from "../../../chunks/how_to/github-actions.5.mdx";
import GitHubActions6 from "../../../chunks/how_to/github-actions.6.mdx";

<GitHubActions1 />

1. Crea un archivo de `workflow` de GitHub Actions. (p.ej: `.github/workflows/benchmark.yml`)
2. Ejecuta `push` en eventos para la branch `main`. Consulta la [documentaci√≥n de `on` de GitHub Actions](https://docs.github.com/es/actions/using-workflows/workflow-syntax-for-github-actions#on) para una visi√≥n general completa. Tambi√©n puedes ver [Pull Requests](#pull-requests) a continuaci√≥n.
3. Crea un `trabajo` de GitHub Actions. (p.ej: `benchmark_with_bencher`)
4. El proyecto ya debe existir. Ajusta la opci√≥n `--project` o la variable de entorno `BENCHER_PROJECT` al slug del proyecto o al UUID (p.ej: `BENCHER_PROJECT: save-walter-white`).
5. El token de API ya debe existir. Agrega `BENCHER_API_TOKEN` como un secreto del **Repositorio**. (p.ej: `Repo -> Configuraci√≥n -> Secretos y variables -> Acciones -> Nuevo secreto del repositorio`) Ajusta la opci√≥n `--token` o variable de entorno `BENCHER_API_TOKEN` al token de API. (p.ej: `BENCHER_API_TOKEN: ${{ secrets.BENCHER_API_TOKEN }}`)
6. Opcional: Ajusta la opci√≥n `--testbed` o la variable de entorno `BENCHER_TESTBED` al slug de Testbed o al UUID.  (p.ej: `BENCHER_TESTBED: ubuntu-latest`) El Testbed **debe** ya existir. Si esto no est√° ajustado, entonces el Testbed `localhost` ser√° usado.
7. Opcional: Ajusta la opci√≥n `--adapter` o la variable de entorno `BENCHER_ADAPTER` al nombre del adaptador deseado.  (p.ej: `BENCHER_ADAPTER: json`) Si esto no est√° ajustado, entonces el Adapter `magic` ser√° usado. Consulta los [adaptadores de harness de benchmark](/docs/es/explanation/adapters) para obtener una visi√≥n general completa.
8. Verifica tu c√≥digo fuente. (p.ej: `uses: actions/checkout@v3`)
9. Instala la CLI de Bencher usando la [Acci√≥n de GitHub](https://github.com/marketplace/actions/bencher-cli). (p.ej: `uses: bencherdev/bencher@main`)
10. [Monitorear tus benchmarks](/docs/es/how-to/track-benchmarks) con el subcomando CLI de <code><a href="/docs/es/explanation/bencher-run">bencher run</a></code>:
    1.  Opcional: Ajusta la opci√≥n `--branch` o la variable de entorno `BENCHER_BRANCH` al slug de la Branch o al UUID. (p.ej: `--branch main`) La Branch **debe** ya existir. Si esto no est√° ajustado, entonces la Branch `main` ser√° usada.
    2. Ajusta el comando para fallar si una Alerta es generada. (p.ej: `--err`) Para que una Alerta sea generada, un [Umbral](/docs/es/explanation/thresholds) debe ya existir.
    3. Ejecuta tus benchmarks y genera un Reporte desde los resultados. (p.ej: `"bencher mock"`)

<br/>

## Pull Requests

Para detectar la regresi√≥n del rendimiento en los Pull Requests, necesitar√°s ejecutar tus benchmarks en PRs.
Si solo esperas tener PRs desde las branch dentro del **mismo** repositorio entonces simplemente puedes modificar el ejemplo de arriba para tambi√©n ejecutar `on` en `pull_request`.

> ‚ö†Ô∏è ¬°Esta soluci√≥n solo funciona si todos los PRs son del **mismo** repositorio!
> Consulta [Pull Requests desde Forks](#pull-requests-from-forks) a continuaci√≥n.

<GitHubActions2 />

1. Ejecuta `push` en eventos para la branch `main` y en `pull_request`. Es importante limitar la ejecuci√≥n en `push` **solo** a seleccionar las branch (p.ej: `main`) para prevenir pushs a las branch PR de ejecutar dos veces!
2. En lugar de siempre utilizar la branch `main`, usa las [variables de entorno por defecto de la Acci√≥n de GitHub](https://docs.github.com/es/actions/learn-github-actions/variables#default-environment-variables) para:
        1. Usa los datos de la branch actual si ya existen. (p.ej: `--if-branch "$GITHUB_REF_NAME"`)
        2. Crea un clon de los datos y umbrales de la branch objetivo de PR si ya existen. (p.ej: `--else-if-branch "$GITHUB_BASE_REF"`)
        3. De lo contrario, crea un clon de los datos y umbrales de la branch `main`. (p.ej: `--else-if-branch main`)
        4. Hay varias opciones para ajustar la branch del proyecto. Consulta [selecci√≥n de branch](/docs/es/explanation/branch-selection) para una visi√≥n general completa.
3. Ajusta el token de autenticaci√≥n de GitHub API. (p.ej: `--github-actions ${{ secrets.GITHUB_TOKEN }}`) Cuando esta opci√≥n se ajusta como parte de un pull request, entonces los resultados ser√°n adicionados al pull request como un comentario. Esto usa [la variable de entorno `GITHUB_TOKEN` de GitHub Actions](https://docs.github.com/es/actions/security-guides/automatic-token-authentication).
4. Consulta la [documentaci√≥n de bencher run](/docs/es/explanation/bencher-run) para una visi√≥n general completa de todas las maneras de configurar el comentario de pull request con las opciones `--ci-*`.

## Pull Requests from Forks

Si planeas aceptar pull requests desde forks, como es a menudo el caso en proyectos de c√≥digo abierto p√∫blicos,
entonces necesitar√°s manejar las cosas un poco diferente.
Por razones de seguridad, secretos como tu `BENCHER_API_TOKEN` y el `GITHUB_TOKEN` no est√°n disponibles en GitHub Actions para los PRs de fork.
Es decir si un contribuyente externo abre un PR desde un fork el ejemplo de arriba no funcionar√°.
Hay tres opciones para los PRs de fork:

<ul>
  <li>[Benchmark Fork PR desde Branch Objetivo](#benchmark-fork-pr-from-target-branch)</li>
  <li>[Benchmark Fork PR desde Branch Objetivo con Revisores Requeridos](#benchmark-fork-pr-from-target-branch-with-required-reviewers)</li>
  <li>[Benchmark Fork PR y Subir desde Branch por Defecto](#benchmark-fork-pr-and-upload-from-default-branch)</li>
</ul>

### Benchmark Fork PR desde Branch Objetivo

<GitHubActions4 />

1. Ejecuta `push` en eventos para la branch `main` y [on `pull_request_target` eventos](https://docs.github.com/es/actions/using-workflows/events-that-trigger-workflows#pull_request_target).
2. Crea un `trabajo` que solo se ejecuta para `push` en eventos para la branch `main`. Aparte de la condici√≥n `if`, este trabajo es casi id√©ntico al ejemplo original de arriba.
3. Crea un `trabajo` que solo se ejecuta para `pull_request_target` eventos.
   1. Verifica la branch del PR.
   2. Pasa todos los secretos directamente. Usa `--token ${{ secrets.BENCHER_API_TOKEN }}` en lugar de la variable de entorno `BENCHER_API_TOKEN`.
   3. Ejecuta y rastrea tus benchmarks de PR con `bencher run`.

Esta configuraci√≥n funciona porque `pull_request_target` se ejecuta en el contexto de la branch objetivo del PR,
donde los secretos como tu `BENCHER_API_TOKEN` y el `GITHUB_TOKEN` est√°n disponibles.
Por lo tanto, este flujo de trabajo solo funcionar√° si existe en la branch _objetivo_.
Evita configurar cualquier secreto como variable de entorno, como `BENCHER_API_TOKEN`.
En su lugar, pasa expl√≠citamente el token de API a `bencher run`. (p.ej: `--token ${{ secrets.BENCHER_API_TOKEN }}`)
Consulta esta [rese√±a del laboratorio de seguridad de GitHub](https://securitylab.github.com/research/github-actions-preventing-pwn-requests/)
y [este post de blog](https://nathandavison.com/blog/github-actions-and-the-threat-of-malicious-pull-requests)
sobre c√≥mo prevenir peticiones pwn para una visi√≥n general completa.

### Benchmark Fork PR desde Branch Objetivo con Revisores Requeridos

<GitHubActions5 />

Esta configuraci√≥n es exactamente la misma que [Benchmark Fork PR desde Branch Objetivo](#benchmark-fork-pr-from-target-branch)
con el requisito adicional de aprobaci√≥n de un revisor obligatorio antes de cada ejecuci√≥n de PR de fork.
Los pull requests del mismo repositorio no requieren aprobaci√≥n.
Para configurar esto, necesitas [crear dos Ambientes de Acci√≥n de GitHub](https://docs.github.com/es/actions/deployment/targeting-different-environments/using-environments-for-deployment#using-an-environment)
(p.ej: `Repo -> Configuraci√≥n -> Ambientes -> Nuevo ambiente`).
El ambiente `internal` no debe tener ninguna `Regla de protecci√≥n de despliegue`.
Sin embargo, el ambiente `external` debe tener `Revisores requeridos` ajustado a aquellos de confianza para revisar PR de fork antes del benchmarking.

### Benchmark Fork PR y Subir desde Branch por Defecto

<GitHubActions6 />

1. Crea un archivo de flujo de trabajo `Run and Cache Benchmarks`.
1. Ejecuta tus benchmarks en `pull_request` eventos.
1. Guarda los resultados de benchmark en un archivo y sube como archivo de artefacto.
1. Sube el evento `pull_request` como un archivo de artefacto.
1. Crea un segundo archivo de flujo de trabajo, `Track Benchmarks`.
1. Encadena `Track Benchmarks` a `Run and Cache Benchmarks` con [el evento `workflow_run`](https://docs.github.com/es/actions/using-workflows/events-that-trigger-workflows#workflow_run).
1. Extrae los datos necesarios del evento `pull_request` almacenado en la cach√©.
1. Rastrea los resultados de benchmark almacenados en la cach√© con `bencher run`.
1. Crea un tercer archivo de flujo de trabajo y usa el ejemplo inicial de arriba para ejecutar en `push` eventos a la branch `main`.

Esta configuraci√≥n funciona porque `workflow_run` se ejecuta en el contexto de la branch por defecto del repositorio,
donde los secretos como tu `BENCHER_API_TOKEN` y el `GITHUB_TOKEN` est√°n disponibles.
Por lo tanto, estos flujos de trabajo solo se ejecutar√°n si existen en la branch _por defecto_.
Consulta [usando datos desde el flujo de trabajo que dispara](https://docs.github.com/es/actions/using-workflows/events-that-trigger-workflows#using-data-from-the-triggering-workflow) para una visi√≥n general completa.
El n√∫mero de pull request, la branch principal, y la branch base usadas en el flujo de trabajo inicial deben ser pasados expl√≠citamente ya que no est√°n disponibles dentro de `workflow_run`.

<br/>
<br/>

> üê∞ ¬°Felicidades! ¬°Has aprendido c√≥mo usar Bencher en GitHub Actions! üéâ

<br/>

<h2><a href="/docs/es/explanation/benchmarking">Contin√∫a: Visi√≥n General de los Benchmarks ‚û°</a></h2>
