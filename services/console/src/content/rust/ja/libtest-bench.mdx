---
title: "libtest bench"
description: "libtest benchã‚’ä½¿ç”¨ã—ã¦Rustã‚³ãƒ¼ãƒ‰ã®ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã‚’å–ã‚‹æ–¹æ³•ã«ã¤ã„ã¦ã®ã‚¹ãƒ†ãƒƒãƒ—ãƒã‚¤ã‚¹ãƒ†ãƒƒãƒ—ã‚¬ã‚¤ãƒ‰"
heading: "libtest benchã‚’ä½¿ç”¨ã—ã¦Rustã‚³ãƒ¼ãƒ‰ã®ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã‚’å–ã‚‹æ–¹æ³•"
published: "2023-10-18T10:28:00Z"
modified: "2024-02-13T06:50:00Z"
sortOrder: 1
---

import Benchmarking from "../../../chunks/benchmarking/ja/benchmarking.mdx";
import FizzBuzzRules from "../../../chunks/benchmarking/ja/fizz-buzz-rules.mdx";
import FizzBuzzRustCode from "../../../chunks/rust/fizz-buzz-rust-code.mdx";
import FizzBuzzRust from "../../../chunks/rust/ja/fizz-buzz-rust.mdx";
import StepByStepRust from "../../../chunks/rust/ja/step-by-step-rust.mdx";
import MicroVsMacro from "../../../chunks/benchmarking/ja/micro-vs-macro.mdx";
import BenchmarkingRust from "../../../chunks/rust/ja/benchmarking-rust.mdx";
import RustToolchainRustBenchCode from "../../../chunks/rust/bench/rust-toolchain-rust-bench-code.mdx";
import RustToolchainRustBenchTree from "../../../chunks/rust/bench/rust-toolchain-rust-bench-tree.mdx";
import FizzBuzzRefactorRust from "../../../chunks/rust/bench/ja/fizz-buzz-refactor-rust.mdx";
import TestCreateRustBenchCode from "../../../chunks/rust/bench/test-crate-rust-bench-code.mdx"
import BenchPlayGameRustBenchCode from "../../../chunks/rust/bench/bench-play-game-rust-bench-code.mdx";
import BenchPlayGameRustBenchOutput from "../../../chunks/rust/bench/bench-play-game-rust-bench-output.mdx";
import FizzBuzzFibonacciRust from "../../../chunks/rust/ja/fizz-buzz-fibonacci-rust.mdx";
import PlayGameRustCode from "../../../chunks/rust/bench/play-game-rust-code.mdx";
import BenchPlayGameFibonacciRustBenchOutput from "../../../chunks/rust/bench/bench-play-game-fibonacci-rust-bench-output.mdx";
import FizzBuzzFibonacciOpenRust from "../../../chunks/rust/ja/fizz-buzz-fibonacci-open-rust.mdx";
import FizzBuzzFibonacciOpenRustCode from "../../../chunks/rust/bench/fizz-buzz-fibonacci-open-rust-code.mdx";
import TheEnd from "../../../chunks/benchmarking/ja/the-end.mdx";
import OnFire from "../../../chunks/benchmarking/ja/on-fire.mdx";
import BenchPlayGameOnFireRustBenchCode from "../../../chunks/rust/bench/bench-play-game-on-fire-rust-bench-code.mdx";
import BenchPlayGameOnFireRustBenchOutputStart from "../../../chunks/rust/bench/bench-play-game-on-fire-rust-bench-output-start.mdx";
import BenchPlayGameOnFireRustBenchOutput from "../../../chunks/rust/bench/bench-play-game-on-fire-rust-bench-output.mdx";
import FizzBuzzFibonacciFixRust from "../../../chunks/rust/ja/fizz-buzz-fibonacci-fix-rust.mdx";
import BenchPlayGameFixRustBenchOutput from "../../../chunks/rust/bench/bench-play-game-fix-rust-bench-output.mdx";
import CatchInCi from "../../../chunks/benchmarking/ja/catch-in-ci.mdx";
import CatchInCiRustBenchOutput from "../../../chunks/rust/bench/catch-in-ci-rust-bench-output.mdx";
import CatchInCiPlot from "../../../chunks/benchmarking/ja/catch-in-ci-plot.mdx";
import CatchInCiPlotRustBench from "../../../chunks/rust/catch-in-ci-plot-rust-bench.mdx";
import BencherFooter from "../../../chunks/learn/ja/bencher-footer.mdx";

<Benchmarking />

<FizzBuzzRust />

<StepByStepRust />

<MicroVsMacro />

<BenchmarkingRust />

ã™ã¹ã¦ãŒ [Bencherã«ã‚ˆã£ã¦ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã™](/ja/docs/explanation/adapters/)ã€‚ã§ã¯ã€ãªãœlibtest benchã‚’é¸ã¶ã®ã§ã—ã‚‡ã†ã‹ï¼Ÿ
ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®å¤–éƒ¨ä¾å­˜é–¢ä¿‚ã‚’åˆ¶é™ã—ã‚ˆã†ã¨ã—ã¦ã„ã‚‹ã€ã¾ãŸã¯ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒã™ã§ã«`nightly`ãƒ„ãƒ¼ãƒ«ãƒã‚§ã‚¤ãƒ³ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆã€
ãã‚Œã‚’ä½¿ç”¨ã™ã‚‹ã¨è‰¯ã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚ãã®ä»–ã®å ´åˆã€Criterionã¾ãŸã¯Iaiã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚

### Rust `nightly` ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

ä»¥ä¸Šã‚’è¸ã¾ãˆã¦ã€libtest benchã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã«ã—ãŸã®ã§ã€Rustãƒ„ãƒ¼ãƒ«ãƒã‚§ãƒ¼ãƒ³ã‚’ `nightly` ã«è¨­å®šã—ã¾ã—ã‚‡ã†ã€‚
`game`ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ«ãƒ¼ãƒˆã«`rust-toolchain.toml`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã€`Cargo.toml`ã®éš£ã«é…ç½®ã—ã¾ã™ã€‚

<RustToolchainRustBenchCode />

ã‚ãªãŸã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ã¯æ¬¡ã®ã‚ˆã†ã«ãªã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

<RustToolchainRustBenchTree />

ãã‚ŒãŒå®Œäº†ã—ãŸã‚‰ã€`cargo run`ã‚’å†å®Ÿè¡Œã—ã¾ã™ã€‚
æ–°ã—ã„, `nightly`ãƒ„ãƒ¼ãƒ«ãƒã‚§ã‚¤ãƒ³ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã«å°‘ã€…æ™‚é–“ãŒã‹ã‹ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚
ãã®å¾Œã€å†å®Ÿè¡Œã—ã€ä»¥å‰ã¨åŒã˜å‡ºåŠ›ã‚’å¾—ã‚‰ã‚Œã‚‹ã¯ãšã§ã™ã€‚

<FizzBuzzRefactorRust />

## FizzBuzzã®ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯å–å¾—

å®‰å®šã—ã¦ã„ãªã„libtestã‚¯ãƒ¬ãƒ¼ãƒˆã‚’ä½¿ç”¨ã™ã‚‹ã«ã¯ã€ `test` æ©Ÿèƒ½ã‚’ã‚³ãƒ¼ãƒ‰ã«æœ‰åŠ¹ã«ã—ã€`test`ã‚¯ãƒ¬ãƒ¼ãƒˆã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ `main.rs`ã® _ä¸€ç•ªä¸Šã«_ æ¬¡ã®è¡Œã‚’è¿½åŠ ã—ã¾ã™ã€‚

<TestCreateRustBenchCode />

ã“ã‚Œã§æœ€åˆã®ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã‚’è¿½åŠ ã™ã‚‹æº–å‚™ãŒæ•´ã„ã¾ã—ãŸï¼
`main.rs`ã® _ä¸€ç•ªä¸‹ã«_ æ¬¡ã®è¡Œã‚’è¿½åŠ ã—ã¾ã™ã€‚

<BenchPlayGameRustBenchCode />

- `benchmarks`ã¨ã„ã†åå‰ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ä½œæˆã—ã€
  [ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©è¨­å®š](https://doc.rust-lang.org/reference/conditional-compilation.html#the-cfg-attribute)
  ã‚’[`test` mode](https://doc.rust-lang.org/book/ch11-03-test-organization.html#the-tests-module-and-cfgtest)ã«ã—ã¾ã™ã€‚
- ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ãƒ©ãƒ³ãƒŠãƒ¼`Bencher`ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã™ã€‚(ğŸ°ã‚¯ãƒ¼ãƒ«ãªåå‰ã§ã™ã­ï¼)
- ç§ãŸã¡ã®`play_game`é–¢æ•°ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã™ã€‚
- `Bencher`ã¸ã®å¯å¤‰å‚ç…§ã‚’å–ã‚‹ã€`bench_play_game`ã¨ã„ã†åå‰ã®ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã‚’ä½œæˆã—ã¾ã™ã€‚
- `bench_play_game`ãŒãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã§ã‚ã‚‹ã“ã¨ã‚’ç¤ºã™ãŸã‚ã«ã€`#[bench]`å±æ€§ã‚’è¨­å®šã—ã¾ã™ã€‚
- `Bencher`ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹(`b`)ã‚’ä½¿ã£ã¦ã€ç§ãŸã¡ã®ãƒã‚¯ãƒ­ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã‚’ä½•åº¦ã‚‚å®Ÿè¡Œã—ã¾ã™ã€‚
- ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãŒã‚³ãƒ¼ãƒ‰ã‚’æœ€é©åŒ–ã—ãªã„ã‚ˆã†ã«ã€ç§ãŸã¡ã®ãƒã‚¯ãƒ­ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã‚’"ãƒ–ãƒ©ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹"å†…ã§å®Ÿè¡Œã—ã¾ã™ã€‚
- `1`ã‹ã‚‰`100`ã¾ã§ã‚’å«ã‚ã¦ã‚¤ãƒ†ãƒ¬ãƒ¼ãƒˆã—ã¾ã™ã€‚
- ãã‚Œãã‚Œã®æ•°å­—ã§ã€`play_game`ã‚’å‘¼ã³å‡ºã—ã¾ã™ã€‚

ã“ã‚Œã§ã‚³ãƒ¼ãƒ‰ã®ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã‚’å–ã‚‹æº–å‚™ãŒæ•´ã„ã¾ã—ãŸã€`cargo bench`ã‚’å®Ÿè¡Œã—ã¾ã™ï¼š

<BenchPlayGameRustBenchOutput />

> ğŸ° ãƒ¬ãƒ†ã‚£ã‚¹ã¨ã‚¿ãƒ¼ãƒ‹ãƒƒãƒ—ã®ãƒ“ãƒ¼ãƒˆ!ç§ãŸã¡ãŒæœ€åˆã®ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ãƒ¡ãƒˆãƒªãƒƒã‚¯ã‚’ã‚²ãƒƒãƒˆã—ãŸã‚ˆï¼

ã¤ã„ã«ã€æˆ‘ã€…ã¯ç–²ã‚ŒãŸé–‹ç™ºè€…ã®é ­ã‚’ä¼‘ã‚ã‚‹ã“ã¨ãŒã§ãã¾ã™...
å†—è«‡ã§ã™ã€æˆ‘ã€…ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯æ–°ã—ã„æ©Ÿèƒ½ã‚’æœ›ã‚“ã§ã„ã¾ã™ï¼

<FizzBuzzFibonacciRust>
  <PlayGameRustCode />
</FizzBuzzFibonacciRust>

## FizzBuzzFibonacciã®ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯å–å¾—

ã“ã‚Œã§ã€ç§ãŸã¡ã®ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã‚’å†åº¦å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼š

<BenchPlayGameFibonacciRustBenchOutput />

ç§ãŸã¡ã®ã‚¿ãƒ¼ãƒŸãƒŠãƒ«å±¥æ­´ã‚’æˆ»ã—ã¦ã¿ã‚‹ã¨ã€FizzBuzzã¨FizzBuzzFibonacciã®ã‚²ãƒ¼ãƒ æ€§èƒ½ã‚’çœ¼çƒã§æ¯”è¼ƒã§ãã¾ã™ï¼š`4,879 ns` vs `22,167 ns`ã€‚
ã‚ãªãŸã®æ•°å­—ã¯ç§ã®ã‚‚ã®ã¨å°‘ã—ç•°ãªã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚
ã—ã‹ã—ã€2ã¤ã®ã‚²ãƒ¼ãƒ é–“ã®å·®ã¯ãŠãã‚‰ã5å€ã®ç¯„å›²ã«ã‚ã‚Šã¾ã™ã€‚
ãã‚Œã¯ç§ã«ã¨ã£ã¦è‰¯ã„ã‚ˆã†ã«æ€ãˆã¾ã™ï¼ç‰¹ã«ã€ç§ãŸã¡ã®ã‚²ãƒ¼ãƒ ã«_Fibonacci_ã¨ã„ã†ãƒ•ã‚¡ãƒ³ã‚·ãƒ¼ãã†ãªæ©Ÿèƒ½ã‚’è¿½åŠ ã—ã¦ã„ã‚‹ã®ã§ã€‚
å­ä¾›ãŸã¡ã¯ãã‚Œã‚’æ„›ã™ã‚‹ã§ã—ã‚‡ã†ï¼

<FizzBuzzFibonacciOpenRust>
  <FizzBuzzFibonacciOpenRustCode />
</FizzBuzzFibonacciOpenRust>

<TheEnd />

<br />

<OnFire />

<BenchPlayGameOnFireRustBenchCode />

- ã‚²ãƒ¼ãƒ ã‚’æ•°å­—ä¸€ç™¾(`100`)ã§éŠã¶ãŸã‚ã®ãƒã‚¤ã‚¯ãƒ­ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯`bench_play_game_100`
- ã‚²ãƒ¼ãƒ ã‚’æ•°å­—ä¸€ç™¾ä¸‡(`1_000_000`)ã§éŠã¶ãŸã‚ã®ãƒã‚¤ã‚¯ãƒ­ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯`bench_play_game_1_000_000`

ç§ãŒã“ã‚Œã‚’å®Ÿè¡Œã—ãŸæ™‚ã€ç§ã¯ã“ã‚Œã‚’å¾—ã¾ã—ãŸ:

<BenchPlayGameOnFireRustBenchOutputStart />

å¾…ã£ã¦ã€å¾…ã£ã¦...

<BenchPlayGameOnFireRustBenchOutput />

ä½•ï¼ `439 ns` x `1,000`ã¯ `439,000 ns`ã§ã‚ã‚‹ã¹ãã§ã€`9,586,977 ns`ã§ã¯ã‚ã‚Šã¾ã›ã‚“ ğŸ¤¯
ç§ãŒç§ã®ãƒ•ã‚£ãƒœãƒŠãƒƒãƒé †åˆ—ã‚³ãƒ¼ãƒ‰ã‚’æ©Ÿèƒ½çš„ã«æ­£ã—ãå¾—ãŸã«ã‚‚ã‹ã‹ã‚ã‚‰ãšã€ã©ã“ã‹ã«ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒã‚°ãŒã‚ã‚‹ã¯ãšã§ã™ã€‚

<FizzBuzzFibonacciFixRust />

ã•ã¦ã€ã“ã‚Œã‚‰ã®ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã‚’å†åº¦å®Ÿè¡Œã—ã¦ã€ã©ã®ã‚ˆã†ã«ãªã£ãŸã‹è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

<BenchPlayGameFixRustBenchOutput />

ãŠãŠã€ç´ æ™´ã‚‰ã—ã„ï¼ç§ãŸã¡ã®`bench_play_game`ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã¯ã€ã‚ªãƒªã‚¸ãƒŠãƒ«ã®FizzBuzzã®é ƒã®ãƒ¬ãƒ™ãƒ«ã«æˆ»ã£ã¦ã„ã¾ã™ã€‚
ãã®ã‚¹ã‚³ã‚¢ãŒæ­£ç¢ºã«ä½•ã ã£ãŸã‹è¦šãˆã¦ã„ã‚Œã°ã„ã„ã®ã§ã™ãŒã€‚ãã‚Œã¯3é€±é–“å‰ã§ã™ã‹ã‚‰ã­ã€‚
ç§ã®ã‚¿ãƒ¼ãƒŸãƒŠãƒ«å±¥æ­´ã¯ãã“ã¾ã§é¡ã£ã¦ã„ã¾ã›ã‚“ã€‚
ã—ã‹ã—ã€ãã‚Œã¯è¿‘ã„ã¨æ€ã„ã¾ã™ï¼

`bench_play_game_100` ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã¯ã€ã»ã¼10xä¸‹ãŒã‚Šã¾ã—ãŸã€ `439 ns` ã‹ã‚‰ `46 ns`ã«ã€‚
ãã—ã¦ã€`bench_play_game_1_000_000` ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã¯10,000xä»¥ä¸Šä¸‹ãŒã‚Šã¾ã—ãŸï¼ `9,586,977 ns` ã‹ã‚‰ `53 ns`ã«ï¼

> ğŸ° ã•ã¦ã€å°‘ãªãã¨ã‚‚ã“ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒã‚°ã‚’ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ã«é€ã‚Šå‡ºã™å‰ã«è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ããŸ... ãˆï¼Ÿ ãã†ã§ã™ã­ã€ã†ãƒ¼ã‚“...

<CatchInCi />

<CatchInCiRustBenchOutput />

<CatchInCiPlot />

<CatchInCiPlotRustBench title="libtest benchã‚’ä½¿ç”¨ã—ã¦Rustã‚’ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã™ã‚‹æ–¹æ³•" />

<BencherFooter />